
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <title>异步流 · Kotlin 官方文档 中文版</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 6.0.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="channels.html" />
    
    
    <link rel="prev" href="coroutine-context-and-dispatchers.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    关于本书
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="home.html">
            
                <a href="home.html">
            
                    
                    文档
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="getting-started.html">
            
                <a href="getting-started.html">
            
                    
                    入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="kotlin-tour-welcome.html">
            
                <a href="kotlin-tour-welcome.html">
            
                    
                    Kotlin 之旅
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="d-overview.html">
            
                <a href="d-overview.html">
            
                    
                    概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="multiplatform.html">
            
                <a href="multiplatform.html">
            
                    
                    Kotlin 多平台
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="server-overview.html">
            
                <a href="server-overview.html">
            
                    
                    Kotlin 用于服务器端开发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="android-overview.html">
            
                <a href="android-overview.html">
            
                    
                    Kotlin 用于 Android 开发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="wasm-overview.html">
            
                <a href="wasm-overview.html">
            
                    
                    Kotlin Wasm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="native-overview.html">
            
                <a href="native-overview.html">
            
                    
                    Kotlin 原生
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="js-overview.html">
            
                <a href="js-overview.html">
            
                    
                    Kotlin 用于 JavaScript 开发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="data-analysis-overview.html">
            
                <a href="data-analysis-overview.html">
            
                    
                    Kotlin 用于数据分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="kotlin-ai-apps-development-overview.html">
            
                <a href="kotlin-ai-apps-development-overview.html">
            
                    
                    Kotlin 用于 AI 驱动的应用开发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="competitive-programming.html">
            
                <a href="competitive-programming.html">
            
                    
                    Kotlin 用于竞技程序设计
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="d-whatsnew.html">
            
                <a href="d-whatsnew.html">
            
                    
                    Kotlin 的新特性
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="whatsnew2120.html">
            
                <a href="whatsnew2120.html">
            
                    
                    Kotlin 2.1.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="whatsnew21.html">
            
                <a href="whatsnew21.html">
            
                    
                    Kotlin 2.1.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="whatsnew-eap.html">
            
                <a href="whatsnew-eap.html">
            
                    
                    Kotlin 2.2.0-RC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="d-earlier-whatsnew.html">
            
                <a href="d-earlier-whatsnew.html">
            
                    
                    早期版本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="whatsnew2020.html">
            
                <a href="whatsnew2020.html">
            
                    
                    Kotlin 2.0.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.2" data-path="whatsnew20.html">
            
                <a href="whatsnew20.html">
            
                    
                    Kotlin 2.0.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.3" data-path="whatsnew1920.html">
            
                <a href="whatsnew1920.html">
            
                    
                    Kotlin 1.9.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.4" data-path="whatsnew19.html">
            
                <a href="whatsnew19.html">
            
                    
                    Kotlin 1.9.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.5" data-path="whatsnew1820.html">
            
                <a href="whatsnew1820.html">
            
                    
                    Kotlin 1.8.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.6" data-path="whatsnew18.html">
            
                <a href="whatsnew18.html">
            
                    
                    Kotlin 1.8.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.7" data-path="whatsnew1720.html">
            
                <a href="whatsnew1720.html">
            
                    
                    Kotlin 1.7.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.8" data-path="whatsnew17.html">
            
                <a href="whatsnew17.html">
            
                    
                    Kotlin 1.7.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.9" data-path="whatsnew1620.html">
            
                <a href="whatsnew1620.html">
            
                    
                    Kotlin 1.6.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.10" data-path="whatsnew16.html">
            
                <a href="whatsnew16.html">
            
                    
                    Kotlin 1.6.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.11" data-path="whatsnew1530.html">
            
                <a href="whatsnew1530.html">
            
                    
                    Kotlin 1.5.30
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.12" data-path="whatsnew1520.html">
            
                <a href="whatsnew1520.html">
            
                    
                    Kotlin 1.5.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.13" data-path="whatsnew15.html">
            
                <a href="whatsnew15.html">
            
                    
                    Kotlin 1.5.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.14" data-path="whatsnew1430.html">
            
                <a href="whatsnew1430.html">
            
                    
                    Kotlin 1.4.30
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.15" data-path="whatsnew1420.html">
            
                <a href="whatsnew1420.html">
            
                    
                    Kotlin 1.4.20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.16" data-path="whatsnew14.html">
            
                <a href="whatsnew14.html">
            
                    
                    Kotlin 1.4.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.17" data-path="whatsnew13.html">
            
                <a href="whatsnew13.html">
            
                    
                    Kotlin 1.3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.18" data-path="whatsnew12.html">
            
                <a href="whatsnew12.html">
            
                    
                    Kotlin 1.2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4.19" data-path="whatsnew11.html">
            
                <a href="whatsnew11.html">
            
                    
                    Kotlin 1.1
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="d-releases-and-roadmap.html">
            
                <a href="d-releases-and-roadmap.html">
            
                    
                    版本发布与路线图
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="roadmap.html">
            
                <a href="roadmap.html">
            
                    
                    Kotlin 路线图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="kotlin-language-features-and-proposals.html">
            
                <a href="kotlin-language-features-and-proposals.html">
            
                    
                    Kotlin 语言特性与提案
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="kotlin-evolution-principles.html">
            
                <a href="kotlin-evolution-principles.html">
            
                    
                    Kotlin 演进原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="components-stability.html">
            
                <a href="components-stability.html">
            
                    
                    Kotlin 各组件的稳定性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="releases.html">
            
                <a href="releases.html">
            
                    
                    Kotlin 版本发布
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="d-basics.html">
            
                <a href="d-basics.html">
            
                    
                    基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="basic-syntax.html">
            
                <a href="basic-syntax.html">
            
                    
                    基本语法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="idioms.html">
            
                <a href="idioms.html">
            
                    
                    习惯用法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="l-kotlin-by-example1.html">
            
                <a href="l-kotlin-by-example1.html">
            
                    
                    例学 Kotlin↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="coding-conventions.html">
            
                <a href="coding-conventions.html">
            
                    
                    编码规范
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="d-concepts.html">
            
                <a href="d-concepts.html">
            
                    
                    概念
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="d-types.html">
            
                <a href="d-types.html">
            
                    
                    类型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="d-basic-types.html">
            
                <a href="d-basic-types.html">
            
                    
                    基本类型
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1.1" data-path="basic-types.html">
            
                <a href="basic-types.html">
            
                    
                    概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.2" data-path="numbers.html">
            
                <a href="numbers.html">
            
                    
                    数字
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.3" data-path="unsigned-integer-types.html">
            
                <a href="unsigned-integer-types.html">
            
                    
                    无符号整型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.4" data-path="booleans.html">
            
                <a href="booleans.html">
            
                    
                    布尔
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.5" data-path="characters.html">
            
                <a href="characters.html">
            
                    
                    字符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.6" data-path="strings.html">
            
                <a href="strings.html">
            
                    
                    字符串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.7" data-path="arrays.html">
            
                <a href="arrays.html">
            
                    
                    数组
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="typecasts.html">
            
                <a href="typecasts.html">
            
                    
                    类型检测与类型转换
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="d-control-flow.html">
            
                <a href="d-control-flow.html">
            
                    
                    控制流程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="control-flow.html">
            
                <a href="control-flow.html">
            
                    
                    条件与循环
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.2" data-path="returns.html">
            
                <a href="returns.html">
            
                    
                    返回与跳转
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2.3" data-path="exceptions.html">
            
                <a href="exceptions.html">
            
                    
                    异常
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="packages.html">
            
                <a href="packages.html">
            
                    
                    包与导入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="d-class-and-obj.html">
            
                <a href="d-class-and-obj.html">
            
                    
                    类与对象
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.4.1" data-path="classes.html">
            
                <a href="classes.html">
            
                    
                    类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.2" data-path="inheritance.html">
            
                <a href="inheritance.html">
            
                    
                    继承
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.3" data-path="properties.html">
            
                <a href="properties.html">
            
                    
                    属性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.4" data-path="interfaces.html">
            
                <a href="interfaces.html">
            
                    
                    接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.5" data-path="fun-interfaces.html">
            
                <a href="fun-interfaces.html">
            
                    
                    函数式（SAM）接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.6" data-path="visibility-modifiers.html">
            
                <a href="visibility-modifiers.html">
            
                    
                    可见性修饰符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.7" data-path="extensions.html">
            
                <a href="extensions.html">
            
                    
                    扩展
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.8" data-path="data-classes.html">
            
                <a href="data-classes.html">
            
                    
                    数据类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.9" data-path="sealed-classes.html">
            
                <a href="sealed-classes.html">
            
                    
                    密封类与密封接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.10" data-path="generics.html">
            
                <a href="generics.html">
            
                    
                    泛型：in、out、where
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.11" data-path="nested-classes.html">
            
                <a href="nested-classes.html">
            
                    
                    嵌套类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.12" data-path="enum-classes.html">
            
                <a href="enum-classes.html">
            
                    
                    枚举类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.13" data-path="inline-classes.html">
            
                <a href="inline-classes.html">
            
                    
                    内联类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.14" data-path="object-declarations.html">
            
                <a href="object-declarations.html">
            
                    
                    对象表达式与对象声明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.15" data-path="delegation.html">
            
                <a href="delegation.html">
            
                    
                    委托
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.16" data-path="delegated-properties.html">
            
                <a href="delegated-properties.html">
            
                    
                    属性委托
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4.17" data-path="type-aliases.html">
            
                <a href="type-aliases.html">
            
                    
                    类型别名
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="d-functions.html">
            
                <a href="d-functions.html">
            
                    
                    函数
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.1" data-path="functions.html">
            
                <a href="functions.html">
            
                    
                    函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.2" data-path="lambdas.html">
            
                <a href="lambdas.html">
            
                    
                    lambda 表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.3" data-path="inline-functions.html">
            
                <a href="inline-functions.html">
            
                    
                    内联函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.4" data-path="operator-overloading.html">
            
                <a href="operator-overloading.html">
            
                    
                    操作符重载
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5" data-path="d-builders.html">
            
                <a href="d-builders.html">
            
                    
                    构建器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.5.5.1" data-path="type-safe-builders.html">
            
                <a href="type-safe-builders.html">
            
                    
                    类型安全的构建器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5.5.2" data-path="using-builders-with-builder-inference.html">
            
                <a href="using-builders-with-builder-inference.html">
            
                    
                    使用带有构建器类型推断的构建器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="null-safety.html">
            
                <a href="null-safety.html">
            
                    
                    空安全
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="equality.html">
            
                <a href="equality.html">
            
                    
                    相等性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="this-expressions.html">
            
                <a href="this-expressions.html">
            
                    
                    this 表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9" data-path="async-programming.html">
            
                <a href="async-programming.html">
            
                    
                    异步程序设计技术
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.10" data-path="coroutines-overview.html">
            
                <a href="coroutines-overview.html">
            
                    
                    协程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.11" data-path="annotations.html">
            
                <a href="annotations.html">
            
                    
                    注解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.12" data-path="destructuring-declarations.html">
            
                <a href="destructuring-declarations.html">
            
                    
                    解构声明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.13" data-path="reflection.html">
            
                <a href="reflection.html">
            
                    
                    反射
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="d-data-analysis.html">
            
                <a href="d-data-analysis.html">
            
                    
                    数据分析
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="d-notebook-get-started.html">
            
                <a href="d-notebook-get-started.html">
            
                    
                    Kotlin Notebook 入门
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="get-started-with-kotlin-notebooks.html">
            
                <a href="get-started-with-kotlin-notebooks.html">
            
                    
                    Kotlin Notebook 简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="kotlin-notebook-set-up-env.html">
            
                <a href="kotlin-notebook-set-up-env.html">
            
                    
                    1、环境搭建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.3" data-path="kotlin-notebook-create.html">
            
                <a href="kotlin-notebook-create.html">
            
                    
                    2、创建第一个 Kotlin Notebook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.4" data-path="kotlin-notebook-add-dependencies.html">
            
                <a href="kotlin-notebook-add-dependencies.html">
            
                    
                    3、将依赖添加到 Kotlin Notebook
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="kotlin-notebook-share.html">
            
                <a href="kotlin-notebook-share.html">
            
                    
                    分享 Kotlin Notebook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="data-analysis-notebooks-output-formats.html">
            
                <a href="data-analysis-notebooks-output-formats.html">
            
                    
                    Kotlin Notebook 的输出格式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="d-work-with-data-sources.html">
            
                <a href="d-work-with-data-sources.html">
            
                    
                    使用数据源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.4.1" data-path="data-analysis-work-with-data-sources.html">
            
                <a href="data-analysis-work-with-data-sources.html">
            
                    
                    从文件中取数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4.2" data-path="data-analysis-work-with-api.html">
            
                <a href="data-analysis-work-with-api.html">
            
                    
                    从 web 源与 API 取数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4.3" data-path="data-analysis-connect-to-db.html">
            
                <a href="data-analysis-connect-to-db.html">
            
                    
                    链接数据库并从中取数据
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="data-analysis-visualization.html">
            
                <a href="data-analysis-visualization.html">
            
                    
                    Kotlin Notebook 中数据可视化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="data-analysis-libraries.html">
            
                <a href="data-analysis-libraries.html">
            
                    
                    用于数据分析的库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="d-platforms.html">
            
                <a href="d-platforms.html">
            
                    
                    平台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="d-jvm.html">
            
                <a href="d-jvm.html">
            
                    
                    JVM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.1" data-path="jvm-get-started.html">
            
                <a href="jvm-get-started.html">
            
                    
                    Kotlin/JVM 入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.2" data-path="comparison-to-java.html">
            
                <a href="comparison-to-java.html">
            
                    
                    与 Java 比较
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.3" data-path="java-interop.html">
            
                <a href="java-interop.html">
            
                    
                    在 Kotlin 中调用 Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.4" data-path="java-to-kotlin-interop.html">
            
                <a href="java-to-kotlin-interop.html">
            
                    
                    在 Java 中调用 Kotlin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5" data-path="d-spring.html">
            
                <a href="d-spring.html">
            
                    
                    Spring
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.5.1" data-path="d-jvm-spring-boot-restful.html">
            
                <a href="d-jvm-spring-boot-restful.html">
            
                    
                    使用 Spring Boot 创建用到数据库的 RESTful web 服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.5.1.1" data-path="jvm-get-started-spring-boot.html">
            
                <a href="jvm-get-started-spring-boot.html">
            
                    
                    Spring Boot 与 Kotlin 入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.1.2" data-path="jvm-create-project-with-spring-boot.html">
            
                <a href="jvm-create-project-with-spring-boot.html">
            
                    
                    创建使用 Kotlin 的 Spring Boot 项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.1.3" data-path="jvm-spring-boot-add-data-class.html">
            
                <a href="jvm-spring-boot-add-data-class.html">
            
                    
                    向 Spring Boot 项目添加数据类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.1.4" data-path="jvm-spring-boot-add-db-support.html">
            
                <a href="jvm-spring-boot-add-db-support.html">
            
                    
                    为 Spring Boot 项目添加数据库支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.1.5" data-path="jvm-spring-boot-using-crudrepository.html">
            
                <a href="jvm-spring-boot-using-crudrepository.html">
            
                    
                    使用 Spring Data CrudRepository 进行数据库访问
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.2" data-path="spring-ai-guide.html">
            
                <a href="spring-ai-guide.html">
            
                    
                    构建一个使用 Spring AI 基于 Qdrant 中存储的文档来回答问题的 Kotlin 应用——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.3" data-path="l-spring-docs-kotlin.html">
            
                <a href="l-spring-docs-kotlin.html">
            
                    
                    Spring 框架 Kotlin 文档↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.4" data-path="l-spring-boot-kotlin.html">
            
                <a href="l-spring-boot-kotlin.html">
            
                    
                    使用 Spring Boot 与 Kotlin 构建 web 应用程序——教程↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.5.5" data-path="l-spring-webflux-kotlin-rsocket.html">
            
                <a href="l-spring-webflux-kotlin-rsocket.html">
            
                    
                    使用 Kotlin 协程与 RSocket 创建聊天应用程序——教程↗︎
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.1.6" data-path="jvm-test-using-junit.html">
            
                <a href="jvm-test-using-junit.html">
            
                    
                    在 JVM 平台中用 JUnit 测试代码——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.7" data-path="mixing-java-kotlin-intellij.html">
            
                <a href="mixing-java-kotlin-intellij.html">
            
                    
                    在项目中混用 Java 与 Kotlin——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.8" data-path="jvm-records.html">
            
                <a href="jvm-records.html">
            
                    
                    在 Kotlin 中使用 Java 记录类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.9" data-path="d-java-to-kotlin-migration-guides.html">
            
                <a href="d-java-to-kotlin-migration-guides.html">
            
                    
                    从 Java 到 Kotlin 迁移指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1.9.1" data-path="java-to-kotlin-idioms-strings.html">
            
                <a href="java-to-kotlin-idioms-strings.html">
            
                    
                    字符串
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.9.2" data-path="java-to-kotlin-collections-guide.html">
            
                <a href="java-to-kotlin-collections-guide.html">
            
                    
                    集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.9.3" data-path="java-to-kotlin-nullability-guide.html">
            
                <a href="java-to-kotlin-nullability-guide.html">
            
                    
                    可空性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.1.9.4" data-path="standard-input.html">
            
                <a href="standard-input.html">
            
                    
                    标准输入
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="d-native.html">
            
                <a href="d-native.html">
            
                    
                    原生
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="native-get-started.html">
            
                <a href="native-get-started.html">
            
                    
                    Kotlin/Native 入门——在 IntelliJ IDEA 中
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.2" data-path="native-definition-file.html">
            
                <a href="native-definition-file.html">
            
                    
                    定义文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3" data-path="d-c-interop.html">
            
                <a href="d-c-interop.html">
            
                    
                    与 C 语言互操作
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.3.1" data-path="native-c-interop.html">
            
                <a href="native-c-interop.html">
            
                    
                    与 C 语言互操作性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3.2" data-path="mapping-primitive-data-types-from-c.html">
            
                <a href="mapping-primitive-data-types-from-c.html">
            
                    
                    映射来自 C 语言的原始数据类型——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3.3" data-path="mapping-struct-union-types-from-c.html">
            
                <a href="mapping-struct-union-types-from-c.html">
            
                    
                    映射来自 C 语言的结构与联合类型——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3.4" data-path="mapping-function-pointers-from-c.html">
            
                <a href="mapping-function-pointers-from-c.html">
            
                    
                    映射来自 C 语言的函数指针——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3.5" data-path="mapping-strings-from-c.html">
            
                <a href="mapping-strings-from-c.html">
            
                    
                    映射来自 C 语言的字符串——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3.6" data-path="native-dynamic-libraries.html">
            
                <a href="native-dynamic-libraries.html">
            
                    
                    Kotlin/Native 开发动态库——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.3.7" data-path="native-app-with-c-and-libcurl.html">
            
                <a href="native-app-with-c-and-libcurl.html">
            
                    
                    创建使用 C 语言互操作与 libcurl 的应用——教程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2.4" data-path="d-objc-interop.html">
            
                <a href="d-objc-interop.html">
            
                    
                    与 Objective-C 互操作性
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.4.1" data-path="native-objc-interop.html">
            
                <a href="native-objc-interop.html">
            
                    
                    与 Swift/Objective-C 互操作性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.4.2" data-path="apple-framework.html">
            
                <a href="apple-framework.html">
            
                    
                    Kotlin/Native 开发 Apple framework——教程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2.5" data-path="native-libraries.html">
            
                <a href="native-libraries.html">
            
                    
                    Kotlin/Native 库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.6" data-path="native-platform-libs.html">
            
                <a href="native-platform-libs.html">
            
                    
                    平台库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.7" data-path="d-mem-mgr.html">
            
                <a href="d-mem-mgr.html">
            
                    
                    内存管理器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.7.1" data-path="native-memory-manager.html">
            
                <a href="native-memory-manager.html">
            
                    
                    Kotlin/Native 内存管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.7.2" data-path="native-arc-integration.html">
            
                <a href="native-arc-integration.html">
            
                    
                    与 ARC 集成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.7.3" data-path="native-migration-guide.html">
            
                <a href="native-migration-guide.html">
            
                    
                    迁移到新版内存管理器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.2.8" data-path="native-debugging.html">
            
                <a href="native-debugging.html">
            
                    
                    调试 Kotlin/Native
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.9" data-path="native-ios-symbolication.html">
            
                <a href="native-ios-symbolication.html">
            
                    
                    符号化 iOS 崩溃报告
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.10" data-path="d-ref-and-tips.html">
            
                <a href="d-ref-and-tips.html">
            
                    
                    参考与提示
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.10.1" data-path="native-target-support.html">
            
                <a href="native-target-support.html">
            
                    
                    目标平台支持
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.10.2" data-path="native-improving-compilation-time.html">
            
                <a href="native-improving-compilation-time.html">
            
                    
                    改进编译时间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.10.3" data-path="native-binary-licenses.html">
            
                <a href="native-binary-licenses.html">
            
                    
                    许可证文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2.10.4" data-path="native-faq.html">
            
                <a href="native-faq.html">
            
                    
                    Kotlin/Native FAQ
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="d-wasm.html">
            
                <a href="d-wasm.html">
            
                    
                    WebAssembly（Wasm）
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.3.1" data-path="wasm-get-started.html">
            
                <a href="wasm-get-started.html">
            
                    
                    在 IntelliJ IDEA 中入门 Kotlin/Wasm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.2" data-path="wasm-wasi.html">
            
                <a href="wasm-wasi.html">
            
                    
                    Kotlin/Wasm 与 WASI 入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.3" data-path="wasm-debugging.html">
            
                <a href="wasm-debugging.html">
            
                    
                    调试 Kotlin/Wasm 代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.4" data-path="wasm-js-interop.html">
            
                <a href="wasm-js-interop.html">
            
                    
                    与 JavaScript 的互操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3.5" data-path="wasm-troubleshooting.html">
            
                <a href="wasm-troubleshooting.html">
            
                    
                    故障排查
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="d-javascript.html">
            
                <a href="d-javascript.html">
            
                    
                    JavaScript
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.4.1" data-path="js-project-setup.html">
            
                <a href="js-project-setup.html">
            
                    
                    搭建 Kotlin/JS 项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.2" data-path="running-kotlin-js.html">
            
                <a href="running-kotlin-js.html">
            
                    
                    运行 Kotlin/JS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.3" data-path="dev-server-continuous-compilation.html">
            
                <a href="dev-server-continuous-compilation.html">
            
                    
                    开发服务器与持续编译
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.4" data-path="js-debugging.html">
            
                <a href="js-debugging.html">
            
                    
                    调试 Kotlin/JS 代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.5" data-path="js-running-tests.html">
            
                <a href="js-running-tests.html">
            
                    
                    在 Kotlin/JS 平台中运行测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.6" data-path="javascript-dce.html">
            
                <a href="javascript-dce.html">
            
                    
                    Kotlin/JS 无用代码消除
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.7" data-path="js-ir-compiler.html">
            
                <a href="js-ir-compiler.html">
            
                    
                    Kotlin/JS IR 编译器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8" data-path="d-kotlin-for-js-platform.html">
            
                <a href="d-kotlin-for-js-platform.html">
            
                    
                    Kotlin 用于 JS 平台
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.4.8.1" data-path="browser-api-dom.html">
            
                <a href="browser-api-dom.html">
            
                    
                    浏览器与 DOM API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8.2" data-path="js-interop.html">
            
                <a href="js-interop.html">
            
                    
                    在 Kotlin 中使用 JavaScript 代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8.3" data-path="dynamic-type.html">
            
                <a href="dynamic-type.html">
            
                    
                    动态类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8.4" data-path="using-packages-from-npm.html">
            
                <a href="using-packages-from-npm.html">
            
                    
                    使用来自 npm 的依赖
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8.5" data-path="js-to-kotlin-interop.html">
            
                <a href="js-to-kotlin-interop.html">
            
                    
                    在 JavaScript 中使用 Kotlin 代码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8.6" data-path="js-modules.html">
            
                <a href="js-modules.html">
            
                    
                    JavaScript 模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8.7" data-path="js-reflection.html">
            
                <a href="js-reflection.html">
            
                    
                    Kotlin/JS 反射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4.8.8" data-path="typesafe-html-dsl.html">
            
                <a href="typesafe-html-dsl.html">
            
                    
                    类型安全的 HTML DSL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="d-scripting.html">
            
                <a href="d-scripting.html">
            
                    
                    脚本
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.5.1" data-path="custom-script-deps-tutorial.html">
            
                <a href="custom-script-deps-tutorial.html">
            
                    
                    Kotlin 自定义脚本入门——教程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="l-kotlin-multiplatform-dev.html">
            
                <a href="l-kotlin-multiplatform-dev.html">
            
                    
                    Kotlin 多平台开发↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="d-standard-library.html">
            
                <a href="d-standard-library.html">
            
                    
                    标准库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="d-collections.html">
            
                <a href="d-collections.html">
            
                    
                    集合
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1.1" data-path="collections-overview.html">
            
                <a href="collections-overview.html">
            
                    
                    集合概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.2" data-path="constructing-collections.html">
            
                <a href="constructing-collections.html">
            
                    
                    构造集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.3" data-path="iterators.html">
            
                <a href="iterators.html">
            
                    
                    迭代器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.4" data-path="ranges.html">
            
                <a href="ranges.html">
            
                    
                    区间与数列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.5" data-path="sequences.html">
            
                <a href="sequences.html">
            
                    
                    序列
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.6" data-path="collection-operations.html">
            
                <a href="collection-operations.html">
            
                    
                    集合操作概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.7" data-path="collection-transformations.html">
            
                <a href="collection-transformations.html">
            
                    
                    集合转换操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.8" data-path="collection-filtering.html">
            
                <a href="collection-filtering.html">
            
                    
                    过滤集合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.9" data-path="collection-plus-minus.html">
            
                <a href="collection-plus-minus.html">
            
                    
                    加减操作符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.10" data-path="collection-grouping.html">
            
                <a href="collection-grouping.html">
            
                    
                    分组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.11" data-path="collection-parts.html">
            
                <a href="collection-parts.html">
            
                    
                    取集合的一部分
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.12" data-path="collection-elements.html">
            
                <a href="collection-elements.html">
            
                    
                    取单个元素
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.13" data-path="collection-ordering.html">
            
                <a href="collection-ordering.html">
            
                    
                    排序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.14" data-path="collection-aggregate.html">
            
                <a href="collection-aggregate.html">
            
                    
                    聚合操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.15" data-path="collection-write.html">
            
                <a href="collection-write.html">
            
                    
                    集合写操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.16" data-path="list-operations.html">
            
                <a href="list-operations.html">
            
                    
                    List 相关操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.17" data-path="set-operations.html">
            
                <a href="set-operations.html">
            
                    
                    Set 相关操作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.1.18" data-path="map-operations.html">
            
                <a href="map-operations.html">
            
                    
                    Map 相关操作
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="read-standard-input.html">
            
                <a href="read-standard-input.html">
            
                    
                    读取标准输入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="opt-in-requirements.html">
            
                <a href="opt-in-requirements.html">
            
                    
                    选择加入要求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="scope-functions.html">
            
                <a href="scope-functions.html">
            
                    
                    作用域函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="time-measurement.html">
            
                <a href="time-measurement.html">
            
                    
                    时间度量
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="d-official-library.html">
            
                <a href="d-official-library.html">
            
                    
                    官方库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="d-kotlinx-coroutines.html">
            
                <a href="d-kotlinx-coroutines.html">
            
                    
                    协程（kotlinx.coroutines）
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1.1" data-path="coroutines-guide.html">
            
                <a href="coroutines-guide.html">
            
                    
                    协程指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.2" data-path="coroutines-basics.html">
            
                <a href="coroutines-basics.html">
            
                    
                    协程基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.3" data-path="l-intro-coroutines-and-channels.html">
            
                <a href="l-intro-coroutines-and-channels.html">
            
                    
                    Kotlin 协程与通道介绍↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.4" data-path="cancellation-and-timeouts.html">
            
                <a href="cancellation-and-timeouts.html">
            
                    
                    取消与超时
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.5" data-path="composing-suspending-functions.html">
            
                <a href="composing-suspending-functions.html">
            
                    
                    组合挂起函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.6" data-path="coroutine-context-and-dispatchers.html">
            
                <a href="coroutine-context-and-dispatchers.html">
            
                    
                    协程上下文与调度器
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.13.1.7" data-path="flow.html">
            
                <a href="flow.html">
            
                    
                    异步流
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.8" data-path="channels.html">
            
                <a href="channels.html">
            
                    
                    通道
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.9" data-path="exception-handling.html">
            
                <a href="exception-handling.html">
            
                    
                    协程异常处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.10" data-path="shared-mutable-state-and-concurrency.html">
            
                <a href="shared-mutable-state-and-concurrency.html">
            
                    
                    共享的可变状态与并发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.11" data-path="select-expression.html">
            
                <a href="select-expression.html">
            
                    
                    select 表达式（实验性的）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.12" data-path="debug-coroutines-with-idea.html">
            
                <a href="debug-coroutines-with-idea.html">
            
                    
                    使用 IntelliJ IDEA 调试协程——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.1.13" data-path="debug-flow-with-idea.html">
            
                <a href="debug-flow-with-idea.html">
            
                    
                    使用 IntelliJ IDEA 调试 Kotlin Flow——教程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="serialization.html">
            
                <a href="serialization.html">
            
                    
                    序列化（kotlinx.serialization）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="metadata-jvm.html">
            
                <a href="metadata-jvm.html">
            
                    
                    Kotlin Metadata JVM（kotlin-metadata-jvm）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="d-lincheck.html">
            
                <a href="d-lincheck.html">
            
                    
                    Lincheck（kotlinx.lincheck）
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.4.1" data-path="lincheck-guide.html">
            
                <a href="lincheck-guide.html">
            
                    
                    Lincheck 指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4.2" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                    用 Lincheck 编写第一个测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4.3" data-path="testing-strategies.html">
            
                <a href="testing-strategies.html">
            
                    
                    测试策略
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4.4" data-path="operation-arguments.html">
            
                <a href="operation-arguments.html">
            
                    
                    操作参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4.5" data-path="constraints.html">
            
                <a href="constraints.html">
            
                    
                    数据结构约束
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4.6" data-path="progress-guarantees.html">
            
                <a href="progress-guarantees.html">
            
                    
                    进度保证
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4.7" data-path="sequential-specification.html">
            
                <a href="sequential-specification.html">
            
                    
                    时序规范
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13.5" data-path="l-ktor1.html">
            
                <a href="l-ktor1.html">
            
                    
                    Ktor↗︎
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="d-api-reference.html">
            
                <a href="d-api-reference.html">
            
                    
                    API 参考
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="l-stdlib.html">
            
                <a href="l-stdlib.html">
            
                    
                    标准库（stdlib）↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="l-kotlin-test.html">
            
                <a href="l-kotlin-test.html">
            
                    
                    测试库（kotlin.test）↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="l-kotlinx-coroutines.html">
            
                <a href="l-kotlinx-coroutines.html">
            
                    
                    协程（kotlinx.coroutines）↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="l-kotlinx-serialization.html">
            
                <a href="l-kotlinx-serialization.html">
            
                    
                    序列化（kotlinx.serialization）↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="l-kotlinx-io.html">
            
                <a href="l-kotlinx-io.html">
            
                    
                    Kotlin I/O 库（kotlinx-io）↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="l-kotlinx-datetime.html">
            
                <a href="l-kotlinx-datetime.html">
            
                    
                    日期与时间（kotlinx-datetime）↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" data-path="l-kotlinx-metadata-jvm.html">
            
                <a href="l-kotlinx-metadata-jvm.html">
            
                    
                    JVM 元数据（kotlinx-metadata-jvm）↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" data-path="l-ktor2.html">
            
                <a href="l-ktor2.html">
            
                    
                    Ktor↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" data-path="l-kotlin-gradle-plugin.html">
            
                <a href="l-kotlin-gradle-plugin.html">
            
                    
                    Kotlin Gradle 插件（kotlin-gradle-plugin）↗︎
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="d-language-reference.html">
            
                <a href="d-language-reference.html">
            
                    
                    语言参考
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="keyword-reference.html">
            
                <a href="keyword-reference.html">
            
                    
                    关键字与操作符
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="l-grammar.html">
            
                <a href="l-grammar.html">
            
                    
                    语法↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="l-kotlin-spec.html">
            
                <a href="l-kotlin-spec.html">
            
                    
                    语言规范↗︎
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="d-tools.html">
            
                <a href="d-tools.html">
            
                    
                    工具
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="d-build-tools.html">
            
                <a href="d-build-tools.html">
            
                    
                    构建工具
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1.1" data-path="d-gradle.html">
            
                <a href="d-gradle.html">
            
                    
                    Gradle
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1.1.1" data-path="gradle.html">
            
                <a href="gradle.html">
            
                    
                    Gradle 概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.1.2" data-path="get-started-with-jvm-gradle-project.html">
            
                <a href="get-started-with-jvm-gradle-project.html">
            
                    
                    Gradle 入门——教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.1.3" data-path="gradle-configure-project.html">
            
                <a href="gradle-configure-project.html">
            
                    
                    配置 Gradle 项目
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.1.4" data-path="gradle-best-practices.html">
            
                <a href="gradle-best-practices.html">
            
                    
                    Gradle 最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.1.5" data-path="gradle-compiler-options.html">
            
                <a href="gradle-compiler-options.html">
            
                    
                    Kotlin Gradle 插件中的编译器选项
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.1.6" data-path="gradle-compilation-and-caches.html">
            
                <a href="gradle-compilation-and-caches.html">
            
                    
                    Kotlin Gradle 插件中的编译项与缓存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.1.7" data-path="gradle-plugin-variants.html">
            
                <a href="gradle-plugin-variants.html">
            
                    
                    支持 Gradle 插件变体
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.1.2" data-path="maven.html">
            
                <a href="maven.html">
            
                    
                    Maven
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.1.3" data-path="ant.html">
            
                <a href="ant.html">
            
                    
                    Ant
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="d-dokka.html">
            
                <a href="d-dokka.html">
            
                    
                    Dokka
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.1" data-path="dokka-introduction.html">
            
                <a href="dokka-introduction.html">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.2" data-path="dokka-get-started.html">
            
                <a href="dokka-get-started.html">
            
                    
                    Dokka 入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3" data-path="d-run-dokka.html">
            
                <a href="d-run-dokka.html">
            
                    
                    运行 Dokka
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.3.1" data-path="dokka-gradle.html">
            
                <a href="dokka-gradle.html">
            
                    
                    Gradle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3.2" data-path="dokka-maven.html">
            
                <a href="dokka-maven.html">
            
                    
                    Maven
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.3.3" data-path="dokka-cli.html">
            
                <a href="dokka-cli.html">
            
                    
                    CLI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.2.4" data-path="d-output-formats.html">
            
                <a href="d-output-formats.html">
            
                    
                    输出格式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.2.4.1" data-path="dokka-html.html">
            
                <a href="dokka-html.html">
            
                    
                    HTML
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.4.2" data-path="dokka-markdown.html">
            
                <a href="dokka-markdown.html">
            
                    
                    Markdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.4.3" data-path="dokka-javadoc.html">
            
                <a href="dokka-javadoc.html">
            
                    
                    Javadoc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.2.5" data-path="dokka-plugins.html">
            
                <a href="dokka-plugins.html">
            
                    
                    Dokka 插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2.6" data-path="dokka-module-and-package-docs.html">
            
                <a href="dokka-module-and-package-docs.html">
            
                    
                    模块文档
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="kotlin-ide.html">
            
                <a href="kotlin-ide.html">
            
                    
                    用于 Kotlin 开发的 IDE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="code-style-migration-guide.html">
            
                <a href="code-style-migration-guide.html">
            
                    
                    使用 IntelliJ IDEA 迁移到 Kotlin 代码风格
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="kotlin-notebook-overview.html">
            
                <a href="kotlin-notebook-overview.html">
            
                    
                    Kotlin Notebook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.6" data-path="lets-plot.html">
            
                <a href="lets-plot.html">
            
                    
                    用于 Kotlin 的 Lets-Plot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.7" data-path="run-code-snippets.html">
            
                <a href="run-code-snippets.html">
            
                    
                    运行代码片段
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.8" data-path="kotlin-and-ci.html">
            
                <a href="kotlin-and-ci.html">
            
                    
                    Kotlin 与 TeamCity 的持续集成
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.9" data-path="kotlin-doc.html">
            
                <a href="kotlin-doc.html">
            
                    
                    编写代码文档：KDoc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.10" data-path="kotlin-osgi.html">
            
                <a href="kotlin-osgi.html">
            
                    
                    Kotlin 与 OSGi
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="d-compiler-and-plugin.html">
            
                <a href="d-compiler-and-plugin.html">
            
                    
                    编译器与插件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="d-compiler.html">
            
                <a href="d-compiler.html">
            
                    
                    编译器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1.1" data-path="k2-compiler-migration-guide.html">
            
                <a href="k2-compiler-migration-guide.html">
            
                    
                    K2 编译器迁移指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.2" data-path="command-line.html">
            
                <a href="command-line.html">
            
                    
                    Kotlin 命令行编译器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.1.3" data-path="compiler-reference.html">
            
                <a href="compiler-reference.html">
            
                    
                    Kotlin 编译器选项
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="d-compiler-plugins.html">
            
                <a href="d-compiler-plugins.html">
            
                    
                    编译器插件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.2.1" data-path="all-open-plugin.html">
            
                <a href="all-open-plugin.html">
            
                    
                    全开放编译器插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.2" data-path="no-arg-plugin.html">
            
                <a href="no-arg-plugin.html">
            
                    
                    No-arg 编译器插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.3" data-path="sam-with-receiver-plugin.html">
            
                <a href="sam-with-receiver-plugin.html">
            
                    
                    带有接收者的 SAM 编译器插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.4" data-path="kapt.html">
            
                <a href="kapt.html">
            
                    
                    kapt 编译器插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.5" data-path="lombok.html">
            
                <a href="lombok.html">
            
                    
                    Lombok 编译器插件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2.6" data-path="power-assert.html">
            
                <a href="power-assert.html">
            
                    
                    Power-assert
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="d-compose-compiler.html">
            
                <a href="d-compose-compiler.html">
            
                    
                    Compose 编译器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.3.1" data-path="compose-compiler-migration-guide.html">
            
                <a href="compose-compiler-migration-guide.html">
            
                    
                    Compose 编译器迁移指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3.2" data-path="compose-compiler-options.html">
            
                <a href="compose-compiler-options.html">
            
                    
                    Compose 编译器选项 DSL
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17.4" data-path="d-ksp.html">
            
                <a href="d-ksp.html">
            
                    
                    Kotlin 符号处理（KSP）API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.4.1" data-path="ksp-overview.html">
            
                <a href="ksp-overview.html">
            
                    
                    KSP 概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.2" data-path="ksp-quickstart.html">
            
                <a href="ksp-quickstart.html">
            
                    
                    KSP 快速入门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.3" data-path="ksp-why-ksp.html">
            
                <a href="ksp-why-ksp.html">
            
                    
                    为什么选用 KSP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.4" data-path="ksp-examples.html">
            
                <a href="ksp-examples.html">
            
                    
                    KSP 示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.5" data-path="ksp-additional-details.html">
            
                <a href="ksp-additional-details.html">
            
                    
                    KSP 如何为 Kotlin 代码建模
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.6" data-path="ksp-reference.html">
            
                <a href="ksp-reference.html">
            
                    
                    Java 注解处理对应到 KSP 参考
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.7" data-path="ksp-incremental.html">
            
                <a href="ksp-incremental.html">
            
                    
                    增量处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.8" data-path="ksp-multi-round.html">
            
                <a href="ksp-multi-round.html">
            
                    
                    多轮次处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.9" data-path="ksp-multiplatform.html">
            
                <a href="ksp-multiplatform.html">
            
                    
                    KSP 与 Kotlin 多平台
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.10" data-path="ksp-command-line.html">
            
                <a href="ksp-command-line.html">
            
                    
                    在命令行运行 KSP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4.11" data-path="ksp-faq.html">
            
                <a href="ksp-faq.html">
            
                    
                    常见问题
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="d-learning-materials.html">
            
                <a href="d-learning-materials.html">
            
                    
                    学习资料
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="learning-materials-overview.html">
            
                <a href="learning-materials-overview.html">
            
                    
                    学习资料概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="l-kotlin-by-example2.html">
            
                <a href="l-kotlin-by-example2.html">
            
                    
                    例学 Kotlin↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="koans.html">
            
                <a href="koans.html">
            
                    
                    Kotlin 心印
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.4" data-path="l-kotlin-core-track.html">
            
                <a href="l-kotlin-core-track.html">
            
                    
                    Kotlin 核心课程↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.5" data-path="kotlin-hands-on.html">
            
                <a href="kotlin-hands-on.html">
            
                    
                    Kotlin 动手实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.6" data-path="kotlin-tips.html">
            
                <a href="kotlin-tips.html">
            
                    
                    Kotlin 小窍门
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.7" data-path="books.html">
            
                <a href="books.html">
            
                    
                    图书
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.8" data-path="advent-of-code.html">
            
                <a href="advent-of-code.html">
            
                    
                    Advent of Code 谜题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.9" data-path="d-edu-tools.html">
            
                <a href="d-edu-tools.html">
            
                    
                    在 IDE 中学习（JetBrains 学院）
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.9.1" data-path="edu-tools-learner.html">
            
                <a href="edu-tools-learner.html">
            
                    
                    学习 Kotlin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.9.2" data-path="edu-tools-educator.html">
            
                <a href="edu-tools-educator.html">
            
                    
                    讲授 Kotlin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.10" data-path="d-lib-creator-guidelines.html">
            
                <a href="d-lib-creator-guidelines.html">
            
                    
                    库作者指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.10.1" data-path="api-guidelines-introduction.html">
            
                <a href="api-guidelines-introduction.html">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.2" data-path="d-minimize-mental-complexity.html">
            
                <a href="d-minimize-mental-complexity.html">
            
                    
                    最小化心理复杂性
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.10.2.1" data-path="api-guidelines-minimizing-mental-complexity.html">
            
                <a href="api-guidelines-minimizing-mental-complexity.html">
            
                    
                    概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.2.2" data-path="api-guidelines-simplicity.html">
            
                <a href="api-guidelines-simplicity.html">
            
                    
                    简单
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.2.3" data-path="api-guidelines-readability.html">
            
                <a href="api-guidelines-readability.html">
            
                    
                    可读性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.2.4" data-path="api-guidelines-consistency.html">
            
                <a href="api-guidelines-consistency.html">
            
                    
                    一致性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.2.5" data-path="api-guidelines-predictability.html">
            
                <a href="api-guidelines-predictability.html">
            
                    
                    可预测性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.2.6" data-path="api-guidelines-debuggability.html">
            
                <a href="api-guidelines-debuggability.html">
            
                    
                    可调试性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.2.7" data-path="api-guidelines-testability.html">
            
                <a href="api-guidelines-testability.html">
            
                    
                    可测试性
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18.10.3" data-path="api-guidelines-backward-compatibility.html">
            
                <a href="api-guidelines-backward-compatibility.html">
            
                    
                    反向兼容性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.4" data-path="api-guidelines-informative-documentation.html">
            
                <a href="api-guidelines-informative-documentation.html">
            
                    
                    内容翔实的文档
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.10.5" data-path="api-guidelines-build-for-multiplatform.html">
            
                <a href="api-guidelines-build-for-multiplatform.html">
            
                    
                    构建多平台库
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="d-eap.html">
            
                <a href="d-eap.html">
            
                    
                    早期访问计划（EAP）
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.1" data-path="eap.html">
            
                <a href="eap.html">
            
                    
                    参与 Kotlin 早期访问计划
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2" data-path="configure-build-for-eap.html">
            
                <a href="configure-build-for-eap.html">
            
                    
                    配置构建采用 EAP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="d-other-resources.html">
            
                <a href="d-other-resources.html">
            
                    
                    其他资源
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.20.1" data-path="faq.html">
            
                <a href="faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2" data-path="d-compatibility.html">
            
                <a href="d-compatibility.html">
            
                    
                    Kotlin 兼容性指南
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.20.2.1" data-path="compatibility-guide-21.html">
            
                <a href="compatibility-guide-21.html">
            
                    
                    Kotlin 2.1 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.2" data-path="compatibility-guide-20.html">
            
                <a href="compatibility-guide-20.html">
            
                    
                    Kotlin 2.0 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.3" data-path="compatibility-guide-19.html">
            
                <a href="compatibility-guide-19.html">
            
                    
                    Kotlin 1.9 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.4" data-path="compatibility-guide-18.html">
            
                <a href="compatibility-guide-18.html">
            
                    
                    Kotlin 1.8 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.5" data-path="compatibility-guide-1720.html">
            
                <a href="compatibility-guide-1720.html">
            
                    
                    Kotlin 1.7.20 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.6" data-path="compatibility-guide-17.html">
            
                <a href="compatibility-guide-17.html">
            
                    
                    Kotlin 1.7 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.7" data-path="compatibility-guide-16.html">
            
                <a href="compatibility-guide-16.html">
            
                    
                    Kotlin 1.6 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.8" data-path="compatibility-guide-15.html">
            
                <a href="compatibility-guide-15.html">
            
                    
                    Kotlin 1.5 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.9" data-path="compatibility-guide-14.html">
            
                <a href="compatibility-guide-14.html">
            
                    
                    Kotlin 1.4 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.10" data-path="compatibility-guide-13.html">
            
                <a href="compatibility-guide-13.html">
            
                    
                    Kotlin 1.3 的兼容性指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.2.11" data-path="compatibility-modes.html">
            
                <a href="compatibility-modes.html">
            
                    
                    兼容模式
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20.3" data-path="d-kotlin-foundation.html">
            
                <a href="d-kotlin-foundation.html">
            
                    
                    Kotlin 基金会
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.20.3.1" data-path="l-kotlin-foundation.html">
            
                <a href="l-kotlin-foundation.html">
            
                    
                    Kotlin 基金会↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.3.2" data-path="l-language-committee-guidelines.html">
            
                <a href="l-language-committee-guidelines.html">
            
                    
                    语言委员会准则↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.3.3" data-path="l-submitting-incompatible-changes.html">
            
                <a href="l-submitting-incompatible-changes.html">
            
                    
                    提交不兼容变更指南↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.3.4" data-path="l-guidelines.html">
            
                <a href="l-guidelines.html">
            
                    
                    Kotlin 品牌用途准则↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.3.5" data-path="l-foundation-faq.html">
            
                <a href="l-foundation-faq.html">
            
                    
                    Kotlin 基金会 FAQ↗︎
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20.4" data-path="d-gsoc.html">
            
                <a href="d-gsoc.html">
            
                    
                    Google Summer of Code
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.20.4.1" data-path="gsoc-overview.html">
            
                <a href="gsoc-overview.html">
            
                    
                    概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.4.2" data-path="l-gsoc-2025.html">
            
                <a href="l-gsoc-2025.html">
            
                    
                    Google Summer of Code with Kotlin 2025↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.4.3" data-path="l-gsoc-2024.html">
            
                <a href="l-gsoc-2024.html">
            
                    
                    Google Summer of Code with Kotlin 2024↗︎
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.4.4" data-path="l-gsoc-2023.html">
            
                <a href="l-gsoc-2023.html">
            
                    
                    Google Summer of Code with Kotlin 2023↗︎
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20.5" data-path="security.html">
            
                <a href="security.html">
            
                    
                    安全
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.6" data-path="d-community.html">
            
                <a href="d-community.html">
            
                    
                    社区
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.20.6.1" data-path="contribute.html">
            
                <a href="contribute.html">
            
                    
                    贡献力量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.6.2" data-path="kug-guidelines.html">
            
                <a href="kug-guidelines.html">
            
                    
                    KUG 准则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.6.3" data-path="kotlin-night-guidelines.html">
            
                <a href="kotlin-night-guidelines.html">
            
                    
                    Kotlin 之夜准则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.6.4" data-path="slack-code-of-conduct.html">
            
                <a href="slack-code-of-conduct.html">
            
                    
                    Kotlin Slack 的行为准则与指南
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20.7" data-path="kotlin-brand-assets.html">
            
                <a href="kotlin-brand-assets.html">
            
                    
                    Kotlin 品牌素材
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20.8" data-path="l-press-kit.html">
            
                <a href="l-press-kit.html">
            
                    
                    宣传资料↗︎
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            本书使用 HonKit 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >异步流</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="异步流">异步流</h1>
<p>挂起函数可以异步的返回单个值，但是该如何异步返回<!--
-->多个计算好的值呢？这正是 Kotlin 流（Flow）的用武之地。</p>
<h2 id="表示多个值">表示多个值</h2>
<p>在 Kotlin 中可以使用<a href="https://kotlinlang.org/docs/reference/collections-overview.html" target="_blank">集合</a>来表示多个值。
比如说，我们有一个 <code>simple</code> 函数，它返回一个包含三个数字的 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/" target="_blank">List</a>，
然后使用 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/for-each.html" target="_blank">forEach</a> 打印它们：</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: List&lt;<span class="hljs-built_in">Int</span>&gt; = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    simple().forEach { value -&gt; println(value) } 
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-01.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码输出如下：</p>
<pre><code class="lang-text">1
2
3
</code></pre>
<!--- TEST -->
<h3 id="序列">序列</h3>
<p>如果使用一些消耗 CPU 资源的阻塞代码计算数字<!--
-->（每次计算需要 100 毫秒）那么我们可以使用 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.sequences/" target="_blank">Sequence</a> 来表示数字：</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Sequence&lt;<span class="hljs-built_in">Int</span>&gt; = sequence { <span class="hljs-comment">// 序列构建器</span>
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        Thread.sleep(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们正在计算</span>
        yield(i) <span class="hljs-comment">// 产生下一个值</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    simple().forEach { value -&gt; println(value) } 
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-02.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码输出相同的数字，但在打印每个数字之前等待 100 毫秒。</p>
<!--- TEST 
1
2
3
-->
<h3 id="挂起函数">挂起函数</h3>
<p>然而，计算过程阻塞运行该代码的主线程。
当这些值由异步代码计算时，我们可以使用 <code>suspend</code> 修饰符标记函数 <code>simple</code>，
这样它就可以在不阻塞的情况下执行其工作并将结果作为列表返回：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*                 

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: List&lt;<span class="hljs-built_in">Int</span>&gt; {
    delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 假装我们在这里做了一些异步的事情</span>
    <span class="hljs-keyword">return</span> listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    simple().forEach { value -&gt; println(value) } 
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-03.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码将会在等待一秒之后打印数字。</p>
<!--- TEST 
1
2
3
-->
<h3 id="流">流</h3>
<p>使用 List<int> 结果类型，意味着我们只能一次返回所有值。
为了表示异步计算的值流（stream），我们可以使用 Flow<int> 类型（正如同步计算值会使用 Sequence<int> 类型）：</int></int></int></p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart               </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow { <span class="hljs-comment">// 流构建器</span>
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们在这里做了一些有用的事情</span>
        emit(i) <span class="hljs-comment">// 发送下一个值</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    <span class="hljs-comment">// 启动并发的协程以验证主线程并未阻塞</span>
    launch {
        <span class="hljs-keyword">for</span> (k <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
            println(<span class="hljs-string">"I'm not blocked <span class="hljs-variable">$k</span>"</span>)
            delay(<span class="hljs-number">100</span>)
        }
    }
    <span class="hljs-comment">// 收集这个流</span>
    simple().collect { value -&gt; println(value) } 
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-04.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码在不阻塞主线程的情况下每等待 100 毫秒打印一个数字。在主线程中运行一个<!--
-->单独的协程每 100 毫秒打印一次 “I'm not blocked” 已经经过了验证。</p>
<pre><code class="lang-text">I'm not blocked 1
1
I'm not blocked 2
2
I'm not blocked 3
3
</code></pre>
<!--- TEST -->
<p>注意使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/index.html" target="_blank">Flow</a> 的代码与先前示例的下述区别：</p>
<ul>
<li><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/index.html" target="_blank">Flow</a> 类型的构建器函数名为 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow.html" target="_blank">flow</a>。</li>
<li><code>flow { ... }</code> 构建块中的代码可以挂起。</li>
<li>函数 <code>simple</code> 不再标有 <code>suspend</code> 修饰符。</li>
<li>流使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow-collector/emit.html" target="_blank">emit</a> 函数 <em>发射</em> 值。</li>
<li>流使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect.html" target="_blank">collect</a> 函数 <em>收集</em> 值。</li>
</ul>
<blockquote>
<p>我们可以在 <code>simple</code> 的 <code>flow { ... }</code> 函数体内使用 <code>Thread.sleep</code> 代替 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/delay.html" target="_blank">delay</a>
以观察主线程在本案例中被阻塞了。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<h2 id="流是冷的">流是冷的</h2>
<p>Flow 是一种类似于序列的冷流 — 这段 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow.html" target="_blank">flow</a> 构建器中的代码<!--
-->直到流被收集的时候才运行。这在以下的示例中非常明显：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart      </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow { 
    println(<span class="hljs-string">"Flow started"</span>)
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>)
        emit(i)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    println(<span class="hljs-string">"Calling simple function..."</span>)
    <span class="hljs-keyword">val</span> flow = simple()
    println(<span class="hljs-string">"Calling collect..."</span>)
    flow.collect { value -&gt; println(value) } 
    println(<span class="hljs-string">"Calling collect again..."</span>)
    flow.collect { value -&gt; println(value) } 
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-05.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>打印如下：</p>
<pre><code class="lang-text">Calling simple function...
Calling collect...
Flow started
1
2
3
Calling collect again...
Flow started
1
2
3
</code></pre>
<!--- TEST -->
<p>这是返回一个流的 <code>simple</code> 函数没有标记 <code>suspend</code> 修饰符的主要原因。
The <code>simple()</code> call itself returns quickly and does not wait for anything. The flow starts afresh every time it is
collected and that is why we see "Flow started" every time we call <code>collect</code> again.</p>
<h2 id="流取消基础">流取消基础</h2>
<p>流采用与协程同样的协作取消。像往常一样，流的收集可以在<!--
-->当流在一个可取消的挂起函数（例如 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/delay.html" target="_blank">delay</a>）中挂起的时候取消。
以下示例展示了当 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/with-timeout-or-null.html" target="_blank">withTimeoutOrNull</a> 块中代码在运行的时候流是如何在超时的情况下取消<!--
-->并停止执行其代码的：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart           </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow { 
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>)          
        println(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>)
        emit(i)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    withTimeoutOrNull(<span class="hljs-number">250</span>) { <span class="hljs-comment">// 在 250 毫秒后超时</span>
        simple().collect { value -&gt; println(value) } 
    }
    println(<span class="hljs-string">"Done"</span>)
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-06.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>注意，在 <code>simple</code> 函数中流仅发射两个数字，产生以下输出：</p>
<pre><code class="lang-text">Emitting 1
1
Emitting 2
2
Done
</code></pre>
<!--- TEST -->
<p>See <a href="#流取消检测">Flow cancellation checks</a> section for more details.</p>
<h2 id="流构建器">流构建器</h2>
<p>先前示例中的 <code>flow { ... }</code> 构建器是最基础的一个。还有其他构建器<!--
-->让流可以这样声明：</p>
<ul>
<li><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow-of.html" target="_blank">flowOf</a> 构建器定义了一个发射固定值集的流。</li>
<li>使用 <code>.asFlow()</code>  扩展函数，可以将各种集合与序列转换为流。</li>
</ul>
<p>For example, the snippet that prints the numbers 1 to 3 from a flow can be rewritten as follows:</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
<span class="hljs-comment">//sampleStart</span>
    <span class="hljs-comment">// 将一个整数区间转化为流</span>
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().collect { value -&gt; println(value) }
<span class="hljs-comment">//sampleEnd </span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-07.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<!--- TEST
1
2
3
-->
<h2 id="过渡流操作符">过渡流操作符</h2>
<p>可以使用操作符转换流，就像转换集合与<!--
-->序列一样。
过渡操作符应用于上游流，并返回下游流。
这些操作符也是冷操作符，就像流一样。这类操作符<!--
-->本身不是挂起函数。它运行的速度很快，返回新的转换流的定义。</p>
<p>基础的操作符拥有相似的名字，比如 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map.html" target="_blank">map</a> 与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/filter.html" target="_blank">filter</a>。
这些操作符与序列版的主要区别在于这些操作符中的代码<!--
-->可以调用挂起函数。</p>
<p>举例来说，一个请求中的流可以<!--
-->使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map.html" target="_blank">map</a> 操作符映射出结果，即使执行一个长时间的请求<!--
-->操作也可以使用挂起函数来实现：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart           </span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performRequest</span><span class="hljs-params">(request: <span class="hljs-type">Int</span>)</span></span>: String {
    delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 模仿长时间运行的异步工作</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"response <span class="hljs-variable">$request</span>"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow() <span class="hljs-comment">// 一个请求流</span>
        .map { request -&gt; performRequest(request) }
        .collect { response -&gt; println(response) }
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-08.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>它产生以下三行，每行都比前一行晚一秒出现：</p>
<pre><code class="lang-text">response 1
response 2
response 3
</code></pre>
<!--- TEST -->
<h3 id="转换操作符">转换操作符</h3>
<p>在流转换操作符中，最通用的一种称为 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/transform.html" target="_blank">transform</a>。它可以用来模仿<!--
-->简单的转换，例如 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map.html" target="_blank">map</a> 与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/filter.html" target="_blank">filter</a>，以及实施更复杂的转换。
使用 <code>transform</code> 操作符，我们可以 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow-collector/emit.html" target="_blank">发射</a> 任意值任意次。</p>
<p>比如说，使用 <code>transform</code> 我们可以在执行长时间运行的异步请求之前发射一个字符串<!--
-->并跟踪这个响应：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performRequest</span><span class="hljs-params">(request: <span class="hljs-type">Int</span>)</span></span>: String {
    delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 模仿长时间运行的异步任务</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"response <span class="hljs-variable">$request</span>"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
<span class="hljs-comment">//sampleStart</span>
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow() <span class="hljs-comment">// 一个请求流</span>
        .transform { request -&gt;
            emit(<span class="hljs-string">"Making request <span class="hljs-variable">$request</span>"</span>) 
            emit(performRequest(request)) 
        }
        .collect { response -&gt; println(response) }
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-09.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码的输出如下：</p>
<pre><code class="lang-text">Making request 1
response 1
Making request 2
response 2
Making request 3
response 3
</code></pre>
<!--- TEST -->
<h3 id="限长操作符">限长操作符</h3>
<p>限长过渡操作符（例如 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/take.html" target="_blank">take</a>）在流触及相应限制的时候会将它的<!--
-->执行取消。协程中的取消操作总是通过抛出异常来执行，这样所有的资源管理<!--
-->函数（如 <code>try {...} finally {...}</code> 块）会在取消的情况下正常运行：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">numbers</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">try</span> {                          
        emit(<span class="hljs-number">1</span>)
        emit(<span class="hljs-number">2</span>) 
        println(<span class="hljs-string">"This line will not execute"</span>)
        emit(<span class="hljs-number">3</span>)    
    } <span class="hljs-keyword">finally</span> {
        println(<span class="hljs-string">"Finally in numbers"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    numbers() 
        .take(<span class="hljs-number">2</span>) <span class="hljs-comment">// 只获取前两个</span>
        .collect { value -&gt; println(value) }
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-10.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码的输出清楚地表明，<code>numbers()</code> 函数中对 <code>flow {...}</code> 函数体的执行在<!--
-->发射出第二个数字后停止：</p>
<pre><code class="lang-text">1
2
Finally in numbers
</code></pre>
<!--- TEST -->
<h2 id="末端流操作符">末端流操作符</h2>
<p>末端操作符是在流上用于启动流收集的<em>挂起函数</em>。
<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect.html" target="_blank">collect</a> 是最基础的末端操作符，但是还有另外一些更方便使用的末端操作符：</p>
<ul>
<li>转化为各种集合，例如 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/to-list.html" target="_blank">toList</a> 与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/to-set.html" target="_blank">toSet</a>。</li>
<li>获取第一个（<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/first.html" target="_blank">first</a>）值与确保流发射单个（<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/single.html" target="_blank">single</a>）值的操作符。</li>
<li>使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/reduce.html" target="_blank">reduce</a> 与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/fold.html" target="_blank">fold</a> 将流规约到单个值。</li>
</ul>
<p>举例来说：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
<span class="hljs-comment">//sampleStart         </span>
    <span class="hljs-keyword">val</span> sum = (<span class="hljs-number">1.</span><span class="hljs-number">.5</span>).asFlow()
        .map { it * it } <span class="hljs-comment">// 数字 1 至 5 的平方                        </span>
        .reduce { a, b -&gt; a + b } <span class="hljs-comment">// 求和（末端操作符）</span>
    println(sum)
<span class="hljs-comment">//sampleEnd     </span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-11.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>打印单个数字：</p>
<pre><code class="lang-text">55
</code></pre>
<!--- TEST -->
<h2 id="流是连续的">流是连续的</h2>
<p>流的每次单独收集都是按顺序执行的，除非进行特殊操作的操作符<!--
-->使用多个流。该收集过程直接在协程中运行，该协程调用末端操作符。
默认情况下不启动新协程。
从上游到下游每个过渡操作符都会处理每个发射出的值<!--
-->然后再交给末端操作符。</p>
<p>请参见以下示例，该示例过滤偶数并将其映射到字符串：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
<span class="hljs-comment">//sampleStart         </span>
    (<span class="hljs-number">1.</span><span class="hljs-number">.5</span>).asFlow()
        .filter {
            println(<span class="hljs-string">"Filter <span class="hljs-variable">$it</span>"</span>)
            it % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>              
        }              
        .map { 
            println(<span class="hljs-string">"Map <span class="hljs-variable">$it</span>"</span>)
            <span class="hljs-string">"string <span class="hljs-variable">$it</span>"</span>
        }.collect { 
            println(<span class="hljs-string">"Collect <span class="hljs-variable">$it</span>"</span>)
        }    
<span class="hljs-comment">//sampleEnd                  </span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-12.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>执行：</p>
<pre><code class="lang-text">Filter 1
Filter 2
Map 2
Collect string 2
Filter 3
Filter 4
Map 4
Collect string 4
Filter 5
</code></pre>
<!--- TEST -->
<h2 id="流上下文">流上下文</h2>
<p>流的收集总是在调用协程的上下文中发生。例如，如果有一个流
<code>simple</code>，然后以下代码在它的编写者指定的上下文中<!--
-->运行，而无论流 <code>simple</code> 的实现细节如何：</p>
<pre><code class="lang-kotlin">withContext(context) {
    simple().collect { value -&gt;
        println(value) <span class="hljs-comment">// 运行在指定上下文中</span>
    }
}
</code></pre>
<!--- CLEAR -->
<p>流的该属性称为 <em>上下文保存</em> 。</p>
<p>所以默认的，<code>flow { ... }</code> 构建器中的代码运行在相应流的收集器<!--
-->提供的上下文中。举例来说，考虑打印线程的一个 <code>simple</code> 函数的实现，
它被调用并发射三个数字：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(msg: <span class="hljs-type">String</span>)</span></span> = println(<span class="hljs-string">"[<span class="hljs-subst">${Thread.currentThread().name}</span>] <span class="hljs-variable">$msg</span>"</span>)

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    log(<span class="hljs-string">"Started simple flow"</span>)
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        emit(i)
    }
}  

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    simple().collect { value -&gt; log(<span class="hljs-string">"Collected <span class="hljs-variable">$value</span>"</span>) } 
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-13.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>运行这段代码：</p>
<pre><code class="lang-text">[main @coroutine#1] Started simple flow
[main @coroutine#1] Collected 1
[main @coroutine#1] Collected 2
[main @coroutine#1] Collected 3
</code></pre>
<!--- TEST FLEXIBLE_THREAD -->
<p>由于 <code>simple().collect</code> 是在主线程调用的，那么 <code>simple</code> 的流主体也是在主线程调用的。
这是快速运行或异步代码的理想默认形式，它不关心执行的上下文并且不会<!--
-->阻塞调用者。</p>
<h3 id="a-common-pitfall-when-using-withcontext">A common pitfall when using withContext</h3>
<p>然而，长时间运行的消耗 CPU 的代码也许需要在 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-dispatchers/-default.html" target="_blank">Dispatchers.Default</a> 上下文中执行，并且更新 UI
的代码也许需要在 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-dispatchers/-main.html" target="_blank">Dispatchers.Main</a> 中执行。通常，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/with-context.html" target="_blank">withContext</a> 用于在
Kotlin 协程中改变代码的上下文，但是 <code>flow {...}</code> 构建器中的代码必须遵循上下文<!--
-->保存属性，并且不允许从其他上下文中发射（<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow-collector/emit.html" target="_blank">emit</a>）。</p>
<p>尝试运行下面的代码：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-comment">// 在流构建器中更改消耗 CPU 代码的上下文的错误方式</span>
    kotlinx.coroutines.withContext(Dispatchers.Default) {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
            Thread.sleep(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们以消耗 CPU 的方式进行计算</span>
            emit(i) <span class="hljs-comment">// 发射下一个值</span>
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    simple().collect { value -&gt; println(value) } 
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-14.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码产生如下的异常：</p>
<pre><code class="lang-text">Exception in thread "main" java.lang.IllegalStateException: Flow invariant is violated:
        Flow was collected in [CoroutineId(1), "coroutine#1":BlockingCoroutine{Active}@5511c7f8, BlockingEventLoop@2eac3323],
        but emission happened in [CoroutineId(1), "coroutine#1":DispatchedCoroutine{Active}@2dae0000, Dispatchers.Default].
        Please refer to 'flow' documentation or use 'flowOn' instead
    at ...
</code></pre>
<!--- TEST EXCEPTION -->
<h3 id="flowon-操作符">flowOn 操作符</h3>
<p>例外的是 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow-on.html" target="_blank">flowOn</a> 函数，该函数用于更改流发射的上下文。
以下示例展示了更改流上下文的正确方法，该示例还通过<!--
-->打印相应线程的名字以展示它们的工作方式：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">log</span><span class="hljs-params">(msg: <span class="hljs-type">String</span>)</span></span> = println(<span class="hljs-string">"[<span class="hljs-subst">${Thread.currentThread().name}</span>] <span class="hljs-variable">$msg</span>"</span>)

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        Thread.sleep(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们以消耗 CPU 的方式进行计算</span>
        log(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>)
        emit(i) <span class="hljs-comment">// 发射下一个值</span>
    }
}.flowOn(Dispatchers.Default) <span class="hljs-comment">// 在流构建器中改变消耗 CPU 代码上下文的正确方式</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    simple().collect { value -&gt;
        log(<span class="hljs-string">"Collected <span class="hljs-variable">$value</span>"</span>) 
    } 
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-15.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>注意，当收集发生在主线程中，<code>flow { ... }</code> 是如何在后台线程中工作的：</p>
<!--- TEST FLEXIBLE_THREAD
[DefaultDispatcher-worker-1 @coroutine#2] Emitting 1
[main @coroutine#1] Collected 1
[DefaultDispatcher-worker-1 @coroutine#2] Emitting 2
[main @coroutine#1] Collected 2
[DefaultDispatcher-worker-1 @coroutine#2] Emitting 3
[main @coroutine#1] Collected 3
-->
<p>这里要观察的另一件事是 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow-on.html" target="_blank">flowOn</a> 操作符已改变流的默认顺序性。
现在收集发生在一个协程中（“coroutine#1”）而发射发生在运行于另一个线程中<!--
-->与收集协程并发运行的另一个协程（“coroutine#2”）中。当上游流<!--
-->必须改变其上下文中的 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-dispatcher/index.html" target="_blank">CoroutineDispatcher</a> 的时候，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow-on.html" target="_blank">flowOn</a> 操作符创建了另一个协程。</p>
<h2 id="缓冲">缓冲</h2>
<p>从收集流所花费的时间来看，将流的不同部分运行在不同的协程中<!--
-->将会很有帮助，特别是当涉及到长时间运行的异步操作时。例如，考虑一种情况，
一个 <code>simple</code> 流的发射很慢，它每花费 100 毫秒才产生一个元素；而收集器也非常慢，
需要花费 300 毫秒来处理元素。让我们看看从该流收集三个数字要花费多长时间：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*
<span class="hljs-keyword">import</span> kotlin.system.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们异步等待了 100 毫秒</span>
        emit(i) <span class="hljs-comment">// 发射下一个值</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
    <span class="hljs-keyword">val</span> time = measureTimeMillis {
        simple().collect { value -&gt; 
            delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// 假装我们花费 300 毫秒来处理它</span>
            println(value) 
        } 
    }   
    println(<span class="hljs-string">"Collected in <span class="hljs-variable">$time</span> ms"</span>)
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-16.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>它会产生这样的结果，整个收集过程大约需要 1200 毫秒（3 个数字，每个花费 400 毫秒）：</p>
<pre><code class="lang-text">1
2
3
Collected in 1220 ms
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<p>我们可以在流上使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/buffer.html" target="_blank">buffer</a> 操作符来并发运行这个 <code>simple</code> 流中发射元素的代码以及收集的代码，
而不是顺序运行它们：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*
<span class="hljs-keyword">import</span> kotlin.system.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们异步等待了 100 毫秒</span>
        emit(i) <span class="hljs-comment">// 发射下一个值</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart</span>
    <span class="hljs-keyword">val</span> time = measureTimeMillis {
        simple()
            .buffer() <span class="hljs-comment">// 缓冲发射项，无需等待</span>
            .collect { value -&gt; 
                delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// 假装我们花费 300 毫秒来处理它</span>
                println(value) 
            } 
    }   
    println(<span class="hljs-string">"Collected in <span class="hljs-variable">$time</span> ms"</span>)
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-17.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>它产生了相同的数字，只是更快了，由于我们高效地创建了处理流水线，
仅仅需要等待第一个数字产生的 100 毫秒以及处理每个数字各需<!--
-->花费的 300 毫秒。这种方式大约花费了 1000 毫秒来运行：</p>
<pre><code class="lang-text">1
2
3
Collected in 1071 ms
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<blockquote>
<p>注意，当必须更改 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-dispatcher/index.html" target="_blank">CoroutineDispatcher</a> 时，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow-on.html" target="_blank">flowOn</a> 操作符使用了相同的缓冲机制，
但是我们在这里显式地请求缓冲而不改变执行上下文。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<h3 id="合并">合并</h3>
<p>当流代表部分操作结果或操作状态更新时，可能没有必要<!--
-->处理每个值，而是只处理最新的那个。在本示例中，当收集器处理它们太慢的时候，
<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/conflate.html" target="_blank">conflate</a> 操作符可以用于跳过中间值。构建前面的示例：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*
<span class="hljs-keyword">import</span> kotlin.system.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们异步等待了 100 毫秒</span>
        emit(i) <span class="hljs-comment">// 发射下一个值</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart</span>
    <span class="hljs-keyword">val</span> time = measureTimeMillis {
        simple()
            .conflate() <span class="hljs-comment">// 合并发射项，不对每个值进行处理</span>
            .collect { value -&gt; 
                delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// 假装我们花费 300 毫秒来处理它</span>
                println(value) 
            } 
    }   
    println(<span class="hljs-string">"Collected in <span class="hljs-variable">$time</span> ms"</span>)
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-18.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>我们看到，虽然第一个数字仍在处理中，但第二个和第三个数字已经产生，因此<!--
-->第二个是 <em>conflated</em> ，只有最新的（第三个）被交付给收集器：</p>
<pre><code class="lang-text">1
3
Collected in 758 ms
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<h3 id="处理最新值">处理最新值</h3>
<p>当发射器和收集器都很慢的时候，合并是加快处理速度的一种方式。它通过删除发射值来实现。
另一种方式是取消缓慢的收集器，并在每次发射新值的时候重新启动它。有<!--
-->一组与 <code>xxx</code> 操作符执行相同基本逻辑的 <code>xxxLatest</code> 操作符，但是在新值产生的时候<!-- but cancel the
-->取消执行其块中的代码。让我们在先前的示例中尝试更换 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/conflate.html" target="_blank">conflate</a> 为 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect-latest.html" target="_blank">collectLatest</a>：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*
<span class="hljs-keyword">import</span> kotlin.system.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        delay(<span class="hljs-number">100</span>) <span class="hljs-comment">// 假装我们异步等待了 100 毫秒</span>
        emit(i) <span class="hljs-comment">// 发射下一个值</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart</span>
    <span class="hljs-keyword">val</span> time = measureTimeMillis {
        simple()
            .collectLatest { value -&gt; <span class="hljs-comment">// 取消并重新发射最后一个值</span>
                println(<span class="hljs-string">"Collecting <span class="hljs-variable">$value</span>"</span>) 
                delay(<span class="hljs-number">300</span>) <span class="hljs-comment">// 假装我们花费 300 毫秒来处理它</span>
                println(<span class="hljs-string">"Done <span class="hljs-variable">$value</span>"</span>) 
            } 
    }   
    println(<span class="hljs-string">"Collected in <span class="hljs-variable">$time</span> ms"</span>)
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-19.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>由于 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect-latest.html" target="_blank">collectLatest</a> 的函数体需要花费 300 毫秒，但是新值每 100 秒发射一次，我们看到该代码块<!-- 
-->对每个值运行，但是只收集最后一个值：</p>
<pre><code class="lang-text">Collecting 1
Collecting 2
Collecting 3
Done 3
Collected in 741 ms
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<h2 id="组合多个流">组合多个流</h2>
<p>组合多个流有很多种方式。</p>
<h3 id="zip">Zip</h3>
<p>就像 Kotlin 标准库中的 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.sequences/zip.html" target="_blank">Sequence.zip</a> 扩展函数一样，
流拥有一个 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/zip.html" target="_blank">zip</a> 操作符用于组合两个流中的相关值：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart                                                                           </span>
    <span class="hljs-keyword">val</span> nums = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow() <span class="hljs-comment">// 数字 1..3</span>
    <span class="hljs-keyword">val</span> strs = flowOf(<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>) <span class="hljs-comment">// 字符串</span>
    nums.zip(strs) { a, b -&gt; <span class="hljs-string">"<span class="hljs-variable">$a</span> -&gt; <span class="hljs-variable">$b</span>"</span> } <span class="hljs-comment">// 组合单个字符串</span>
        .collect { println(it) } <span class="hljs-comment">// 收集并打印</span>
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-20.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>示例打印如下：</p>
<pre><code class="lang-text">1 -&gt; one
2 -&gt; two
3 -&gt; three
</code></pre>
<!--- TEST -->
<h3 id="combine">Combine</h3>
<p>当流表示一个变量或操作的最新值时（请参阅<!--
-->相关小节 <a href="#合并">conflation</a>），可能需要执行计算，这依赖于<!--
-->相应流的最新值，并且每当上游流产生值的时候<!--
-->都需要重新计算。这种相应的操作符家族称为 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/combine.html" target="_blank">combine</a>。</p>
<p>例如，先前示例中的数字如果每 300 毫秒更新一次，但字符串每 400 毫秒更新一次，
然后使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/zip.html" target="_blank">zip</a> 操作符合并它们，但仍会产生相同的结果，
尽管每 400 毫秒打印一次结果：</p>
<blockquote>
<p>我们在本示例中使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-each.html" target="_blank">onEach</a> 过渡操作符来延时每次元素发射并使<!--
-->该流更具说明性以及更简洁。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart                                                                           </span>
    <span class="hljs-keyword">val</span> nums = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">300</span>) } <span class="hljs-comment">// 发射数字 1..3，间隔 300 毫秒</span>
    <span class="hljs-keyword">val</span> strs = flowOf(<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>).onEach { delay(<span class="hljs-number">400</span>) } <span class="hljs-comment">// 每 400 毫秒发射一次字符串</span>
    <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis() <span class="hljs-comment">// 记录开始的时间</span>
    nums.zip(strs) { a, b -&gt; <span class="hljs-string">"<span class="hljs-variable">$a</span> -&gt; <span class="hljs-variable">$b</span>"</span> } <span class="hljs-comment">// 使用“zip”组合单个字符串</span>
        .collect { value -&gt; <span class="hljs-comment">// 收集并打印</span>
            println(<span class="hljs-string">"<span class="hljs-variable">$value</span> at <span class="hljs-subst">${System.currentTimeMillis() - startTime}</span> ms from start"</span>) 
        } 
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-21.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<!--- TEST ARBITRARY_TIME
1 -> one at 437 ms from start
2 -> two at 837 ms from start
3 -> three at 1243 ms from start
-->
<p>然而，当在这里使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/combine.html" target="_blank">combine</a> 操作符来替换 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/zip.html" target="_blank">zip</a>：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart                                                                           </span>
    <span class="hljs-keyword">val</span> nums = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">300</span>) } <span class="hljs-comment">// 发射数字 1..3，间隔 300 毫秒</span>
    <span class="hljs-keyword">val</span> strs = flowOf(<span class="hljs-string">"one"</span>, <span class="hljs-string">"two"</span>, <span class="hljs-string">"three"</span>).onEach { delay(<span class="hljs-number">400</span>) } <span class="hljs-comment">// 每 400 毫秒发射一次字符串</span>
    <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis() <span class="hljs-comment">// 记录开始的时间</span>
    nums.combine(strs) { a, b -&gt; <span class="hljs-string">"<span class="hljs-variable">$a</span> -&gt; <span class="hljs-variable">$b</span>"</span> } <span class="hljs-comment">// 使用“combine”组合单个字符串</span>
        .collect { value -&gt; <span class="hljs-comment">// 收集并打印</span>
            println(<span class="hljs-string">"<span class="hljs-variable">$value</span> at <span class="hljs-subst">${System.currentTimeMillis() - startTime}</span> ms from start"</span>) 
        } 
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-22.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>我们得到了完全不同的输出，其中，<code>nums</code> 或 <code>strs</code> 流中的每次发射都会打印一行：</p>
<pre><code class="lang-text">1 -&gt; one at 452 ms from start
2 -&gt; one at 651 ms from start
2 -&gt; two at 854 ms from start
3 -&gt; two at 952 ms from start
3 -&gt; three at 1256 ms from start
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<h2 id="展平流">展平流</h2>
<p>流表示异步接收的值序列，因此很容易遇到这样的情况：
每个值都会触发对另一个值序列的请求。比如说，我们可以拥有下面这样一个返回间隔 500
毫秒的两个字符串流的函数：</p>
<pre><code class="lang-kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestFlow</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>)</span></span>: Flow&lt;String&gt; = flow {
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: First"</span>) 
    delay(<span class="hljs-number">500</span>) <span class="hljs-comment">// 等待 500 毫秒</span>
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: Second"</span>)    
}
</code></pre>
<!--- CLEAR -->
<p>现在，如果我们有一个包含三个整数的流，并对每个整数调用 <code>requestFlow</code>，如下所示：</p>
<pre><code class="lang-kotlin">(<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().map { requestFlow(it) }
</code></pre>
<!--- CLEAR -->
<p>然后我们会得到一个包含流的流（<code>Flow&lt;Flow&lt;String&gt;&gt;</code>），需要将其进行<em>展平</em>为单个流以进行<!--
-->下一步处理。集合与序列都拥有 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.sequences/flatten.html" target="_blank">flatten</a> 与 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.sequences/flat-map.html" target="_blank">flatMap</a>
操作符来做这件事。然而，由于流具有异步的性质，因此需要不同的展平<em>模式</em>，
为此，存在一系列的流展平操作符。</p>
<h3 id="flatmapconcat">flatMapConcat</h3>
<p>将流的流串联由 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-concat.html" target="_blank">flatMapConcat</a> 与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flatten-concat.html" target="_blank">flattenConcat</a> 操作符提供。它们是<!--
-->相应序列操作符最相近的类似物。它们在等待内部流完成之后<!--
-->开始收集下一个值，如下面的示例所示：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestFlow</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>)</span></span>: Flow&lt;String&gt; = flow {
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: First"</span>) 
    delay(<span class="hljs-number">500</span>) <span class="hljs-comment">// 等待 500 毫秒</span>
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: Second"</span>)    
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart</span>
    <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis() <span class="hljs-comment">// 记录开始时间</span>
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">100</span>) } <span class="hljs-comment">// 每 100 毫秒发射一个数字 </span>
        .flatMapConcat { requestFlow(it) }                                                                           
        .collect { value -&gt; <span class="hljs-comment">// 收集并打印</span>
            println(<span class="hljs-string">"<span class="hljs-variable">$value</span> at <span class="hljs-subst">${System.currentTimeMillis() - startTime}</span> ms from start"</span>) 
        } 
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-23.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>在输出中可以清楚地看到 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-concat.html" target="_blank">flatMapConcat</a> 的顺序性质：</p>
<pre><code class="lang-text">1: First at 121 ms from start
1: Second at 622 ms from start
2: First at 727 ms from start
2: Second at 1227 ms from start
3: First at 1328 ms from start
3: Second at 1829 ms from start
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<h3 id="flatmapmerge">flatMapMerge</h3>
<p>另一种展平操作是并发收集所有传入的流，并将它们的值合并到<!--
-->一个单独的流，以便尽快的发射值。
它由 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-merge.html" target="_blank">flatMapMerge</a> 与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flatten-merge.html" target="_blank">flattenMerge</a> 操作符实现。他们都接收可选的<!--
-->用于限制并发收集的流的个数的 <code>concurrency</code> 参数<!--
-->（默认情况下，它等于 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-d-e-f-a-u-l-t_-c-o-n-c-u-r-r-e-n-c-y.html" target="_blank">DEFAULT_CONCURRENCY</a>）。</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestFlow</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>)</span></span>: Flow&lt;String&gt; = flow {
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: First"</span>) 
    delay(<span class="hljs-number">500</span>) <span class="hljs-comment">// 等待 500 毫秒</span>
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: Second"</span>)    
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart</span>
    <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis() <span class="hljs-comment">// 记录开始时间</span>
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">100</span>) } <span class="hljs-comment">// 每 100 毫秒发射一个数字 </span>
        .flatMapMerge { requestFlow(it) }                                                                           
        .collect { value -&gt; <span class="hljs-comment">// 收集并打印</span>
            println(<span class="hljs-string">"<span class="hljs-variable">$value</span> at <span class="hljs-subst">${System.currentTimeMillis() - startTime}</span> ms from start"</span>) 
        } 
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-24.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-merge.html" target="_blank">flatMapMerge</a> 的并发性质很明显：</p>
<pre><code class="lang-text">1: First at 136 ms from start
2: First at 231 ms from start
3: First at 333 ms from start
1: Second at 639 ms from start
2: Second at 732 ms from start
3: Second at 833 ms from start
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<blockquote>
<p>注意，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-merge.html" target="_blank">flatMapMerge</a> 会顺序调用代码块（本示例中的 <code>{ requestFlow(it) }</code>），但是<!--
-->并发收集结果流，相当于执行顺序是首先执行
<code>map { requestFlow(it) }</code> 然后在其返回结果上调用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flatten-merge.html" target="_blank">flattenMerge</a>。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<h3 id="flatmaplatest">flatMapLatest</h3>
<p>与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect-latest.html" target="_blank">collectLatest</a> 操作符类似（在<!--
--><a href="#处理最新值">"处理最新值"</a> 小节中已经描述过），也有相对应的“最新”<!--
-->展平模式，在发出新流后立即取消先前流的收集。
这由 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-latest.html" target="_blank">flatMapLatest</a> 操作符来实现。</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestFlow</span><span class="hljs-params">(i: <span class="hljs-type">Int</span>)</span></span>: Flow&lt;String&gt; = flow {
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: First"</span>) 
    delay(<span class="hljs-number">500</span>) <span class="hljs-comment">// 等待 500 毫秒</span>
    emit(<span class="hljs-string">"<span class="hljs-variable">$i</span>: Second"</span>)    
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; { 
<span class="hljs-comment">//sampleStart</span>
    <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis() <span class="hljs-comment">// 记录开始时间</span>
    (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">100</span>) } <span class="hljs-comment">// 每 100 毫秒发射一个数字 </span>
        .flatMapLatest { requestFlow(it) }                                                                           
        .collect { value -&gt; <span class="hljs-comment">// 收集并打印</span>
            println(<span class="hljs-string">"<span class="hljs-variable">$value</span> at <span class="hljs-subst">${System.currentTimeMillis() - startTime}</span> ms from start"</span>) 
        } 
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-25.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>该示例的输出很好的展示了 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-latest.html" target="_blank">flatMapLatest</a> 的工作方式：</p>
<pre><code class="lang-text">1: First at 142 ms from start
2: First at 322 ms from start
3: First at 425 ms from start
3: Second at 931 ms from start
</code></pre>
<!--- TEST ARBITRARY_TIME -->
<blockquote>
<p>注意，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flat-map-latest.html" target="_blank">flatMapLatest</a> 在收到一个新值时取消了块中的所有代码 (本示例中的 <code>{ requestFlow(it) }</code>）<!--
-->。
这在该特定示例中不会有什么区别，由于调用 <code>requestFlow</code> 自身的速度是很快的，不会发生挂起，
所以不会被取消。然而，a differnce in output would be visible if we were to use suspending functions
like <code>delay</code> in <code>requestFlow</code>.</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<h2 id="流异常">流异常</h2>
<p>当运算符中的发射器或代码抛出异常时，流收集可以带有异常的完成。
有几种处理异常的方法。</p>
<h3 id="收集器-try-与-catch">收集器 try 与 catch</h3>
<p>收集者可以使用 Kotlin 的 <a href="https://kotlinlang.org/docs/reference/exceptions.html" target="_blank"><code>try/catch</code></a> 块来处理异常：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        println(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>)
        emit(i) <span class="hljs-comment">// 发射下一个值</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    <span class="hljs-keyword">try</span> {
        simple().collect { value -&gt;         
            println(value)
            check(value &lt;= <span class="hljs-number">1</span>) { <span class="hljs-string">"Collected <span class="hljs-variable">$value</span>"</span> }
        }
    } <span class="hljs-keyword">catch</span> (e: Throwable) {
        println(<span class="hljs-string">"Caught <span class="hljs-variable">$e</span>"</span>)
    } 
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-26.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>这段代码成功的在末端操作符 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect.html" target="_blank">collect</a> 中捕获了异常，并且，
如我们所见，在这之后不再发出任何值：</p>
<pre><code class="lang-text">Emitting 1
1
Emitting 2
2
Caught java.lang.IllegalStateException: Collected 2
</code></pre>
<!--- TEST -->
<h3 id="一切都已捕获">一切都已捕获</h3>
<p>前面的示例实际上捕获了在发射器或任何过渡或末端操作符中发生的任何异常。
例如，让我们修改代码以便将发出的值<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map.html" target="_blank">映射</a>为字符串，
但是相应的代码会产生一个异常：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;String&gt; = 
    flow {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
            println(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>)
            emit(i) <span class="hljs-comment">// 发射下一个值</span>
        }
    }
    .map { value -&gt;
        check(value &lt;= <span class="hljs-number">1</span>) { <span class="hljs-string">"Crashed on <span class="hljs-variable">$value</span>"</span> }                 
        <span class="hljs-string">"string <span class="hljs-variable">$value</span>"</span>
    }

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    <span class="hljs-keyword">try</span> {
        simple().collect { value -&gt; println(value) }
    } <span class="hljs-keyword">catch</span> (e: Throwable) {
        println(<span class="hljs-string">"Caught <span class="hljs-variable">$e</span>"</span>)
    } 
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-27.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>仍然会捕获该异常并停止收集：</p>
<pre><code class="lang-text">Emitting 1
string 1
Emitting 2
Caught java.lang.IllegalStateException: Crashed on 2
</code></pre>
<!--- TEST -->
<h2 id="异常透明性">异常透明性</h2>
<p>但是，发射器的代码如何封装其异常处理行为？</p>
<p>流必须<em>对异常透明</em>，即在 <code>flow { ... }</code> 构建器内部的 <code>try/catch</code>
块中<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow-collector/emit.html" target="_blank">发射</a>值是违反异常透明性的。这样可以保证收集器抛出的一个异常<!--
-->能被像先前示例中那样的 <code>try/catch</code> 块捕获。</p>
<p>发射器可以使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html" target="_blank">catch</a> 操作符来保留此异常的透明性并允许封装<!--
-->它的异常处理。catch 操作符的代码块可以分析异常<!--
-->并根据捕获到的异常以不同的方式对其做出反应：</p>
<ul>
<li>可以使用 <code>throw</code> 重新抛出异常。</li>
<li>可以使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html" target="_blank">catch</a> 代码块中的 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow-collector/emit.html" target="_blank">emit</a> 将异常转换为值发射出去。</li>
<li>可以将异常忽略，或用日志打印，或使用一些其他代码处理它。</li>
</ul>
<p>例如，让我们在捕获异常的时候发射文本：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;String&gt; = 
    flow {
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
            println(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>)
            emit(i) <span class="hljs-comment">// 发射下一个值</span>
        }
    }
    .map { value -&gt;
        check(value &lt;= <span class="hljs-number">1</span>) { <span class="hljs-string">"Crashed on <span class="hljs-variable">$value</span>"</span> }
        <span class="hljs-string">"string <span class="hljs-variable">$value</span>"</span>
    }

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
<span class="hljs-comment">//sampleStart</span>
    simple()
        .<span class="hljs-keyword">catch</span> { e -&gt; emit(<span class="hljs-string">"Caught <span class="hljs-variable">$e</span>"</span>) } <span class="hljs-comment">// 发射一个异常</span>
        .collect { value -&gt; println(value) }
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-28.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg> 

</blockquote>
<p>即使我们不再在代码的外层使用 <code>try/catch</code>，示例的输出也是相同的。</p>
<!--- TEST  
Emitting 1
string 1
Emitting 2
Caught java.lang.IllegalStateException: Crashed on 2
-->
<h3 id="透明捕获">透明捕获</h3>
<p><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html" target="_blank">catch</a> 过渡操作符遵循异常透明性，仅捕获上游异常<!--
-->（<code>catch</code> 操作符上游的异常，但是它下面的不是）。
如果 <code>collect { ... }</code> 块（位于 <code>catch</code> 之下）抛出一个异常，那么异常会逃逸：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        println(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>)
        emit(i)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    simple()
        .<span class="hljs-keyword">catch</span> { e -&gt; println(<span class="hljs-string">"Caught <span class="hljs-variable">$e</span>"</span>) } <span class="hljs-comment">// 不会捕获下游异常</span>
        .collect { value -&gt;
            check(value &lt;= <span class="hljs-number">1</span>) { <span class="hljs-string">"Collected <span class="hljs-variable">$value</span>"</span> }                 
            println(value) 
        }
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-29.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>尽管有 <code>catch</code> 操作符，但不会打印“Caught ...”消息：</p>
<pre><code class="lang-text">Emitting 1
1
Emitting 2
Exception in thread "main" java.lang.IllegalStateException: Collected 2
    at ...
</code></pre>
<!--- TEST EXCEPTION -->
<h3 id="声明式捕获">声明式捕获</h3>
<p>我们可以将 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html" target="_blank">catch</a> 操作符的声明性与处理所有异常的期望相结合，将 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect.html" target="_blank">collect</a>
操作符的代码块移动到 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-each.html" target="_blank">onEach</a> 中，并将其放到 <code>catch</code> 操作符之前。收集该流必须由调用<!--
-->无参的 <code>collect()</code> 来触发：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.3</span>) {
        println(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>)
        emit(i)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
<span class="hljs-comment">//sampleStart</span>
    simple()
        .onEach { value -&gt;
            check(value &lt;= <span class="hljs-number">1</span>) { <span class="hljs-string">"Collected <span class="hljs-variable">$value</span>"</span> }                 
            println(value) 
        }
        .<span class="hljs-keyword">catch</span> { e -&gt; println(<span class="hljs-string">"Caught <span class="hljs-variable">$e</span>"</span>) }
        .collect()
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-30.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg> 

</blockquote>
<p>现在我们可以看到已经打印了“Caught ...”消息，并且我们可以在没有显式使用
<code>try/catch</code> 块的情况下捕获所有异常：</p>
<pre><code class="lang-text">Emitting 1
1
Emitting 2
Caught java.lang.IllegalStateException: Collected 2
</code></pre>
<!--- TEST EXCEPTION -->
<h2 id="流完成">流完成</h2>
<p>当流收集完成时（普通情况或异常情况），它可能需要执行一个动作。
你可能已经注意到，它可以通过两种方式完成：命令式或声明式。</p>
<h3 id="命令式-finally-块">命令式 finally 块</h3>
<p>除了 <code>try</code>/<code>catch</code> 之外，收集器还能使用 <code>finally</code> 块在 <code>collect</code>
完成时执行一个动作。</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    <span class="hljs-keyword">try</span> {
        simple().collect { value -&gt; println(value) }
    } <span class="hljs-keyword">finally</span> {
        println(<span class="hljs-string">"Done"</span>)
    }
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-31.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg> 

</blockquote>
<p>这段代码打印出 <code>simple</code> 流产生的三个数字，后面跟一个“Done”字符串：</p>
<pre><code class="lang-text">1
2
3
Done
</code></pre>
<!--- TEST  -->
<h3 id="声明式处理">声明式处理</h3>
<p>对于声明式，流拥有 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-completion.html" target="_blank">onCompletion</a> 过渡操作符，它在流完全收集<!--
-->时调用。</p>
<p>可以使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-completion.html" target="_blank">onCompletion</a> 操作符重写前面的示例，并产生相同的输出：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
<span class="hljs-comment">//sampleStart</span>
    simple()
        .onCompletion { println(<span class="hljs-string">"Done"</span>) }
        .collect { value -&gt; println(value) }
<span class="hljs-comment">//sampleEnd</span>
}
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-32.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg> 

</blockquote>
<!--- TEST 
1
2
3
Done
-->
<p><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-completion.html" target="_blank">onCompletion</a> 的主要优点是其 lambda 表达式的可空参数
<code>Throwable</code> 可以用于确定流收集是正常完成还是有异常发生。在下面的<!--
-->示例中 <code>simple</code> 流在发射数字 1 之后抛出了一个异常：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    emit(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">throw</span> RuntimeException()
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    simple()
        .onCompletion { cause -&gt; <span class="hljs-keyword">if</span> (cause != <span class="hljs-literal">null</span>) println(<span class="hljs-string">"Flow completed exceptionally"</span>) }
        .<span class="hljs-keyword">catch</span> { cause -&gt; println(<span class="hljs-string">"Caught exception"</span>) }
        .collect { value -&gt; println(value) }
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-33.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>如你所期望的，它打印了：</p>
<pre><code class="lang-text">1
Flow completed exceptionally
Caught exception
</code></pre>
<!--- TEST -->
<p><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-completion.html" target="_blank">onCompletion</a> 操作符与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html" target="_blank">catch</a> 不同，它不处理异常。我们可以看到前面的<!--
-->示例代码，异常仍然流向下游。它将被提供给后面的 <code>onCompletion</code>
操作符，并可以由 <code>catch</code> 操作符处理。</p>
<h3 id="成功完成">成功完成</h3>
<p>与 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/catch.html" target="_blank">catch</a> 操作符的另一个不同点是 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-completion.html" target="_blank">onCompletion</a> 能观察到所有异常并且<!--
-->仅在上游流成功完成（没有取消或失败）的情况下接收一个 <code>null</code> 异常。</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">simple</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow()

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    simple()
        .onCompletion { cause -&gt; println(<span class="hljs-string">"Flow completed with <span class="hljs-variable">$cause</span>"</span>) }
        .collect { value -&gt;
            check(value &lt;= <span class="hljs-number">1</span>) { <span class="hljs-string">"Collected <span class="hljs-variable">$value</span>"</span> }                 
            println(value) 
        }
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-34.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>我们可以看到完成时 cause 不为空，因为流由于下游异常而中止：</p>
<pre><code class="lang-text">1
Flow completed with java.lang.IllegalStateException: Collected 2
Exception in thread "main" java.lang.IllegalStateException: Collected 2
</code></pre>
<!--- TEST EXCEPTION -->
<h2 id="命令式还是声明式">命令式还是声明式</h2>
<p>现在我们知道如何收集流，并以命令式与声明式的方式处理其完成及异常情况。
这里有一个很自然的问题是，哪种方式应该是首选的？为什么？
作为一个库，我们不主张采用任何特定的方式，并且相信这两种选择都是有效的，
应该根据自己的喜好与代码风格进行选择。</p>
<h2 id="启动流">启动流</h2>
<p>使用流表示来自一些源的异步事件是很简单的。
在这个案例中，我们需要一个类似 <code>addEventListener</code> 的函数，该函数注册一段响应的代码<!--
-->处理即将到来的事件，并继续进行进一步的处理。<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/on-each.html" target="_blank">onEach</a> 操作符可以担任该角色。
然而，<code>onEach</code> 是一个过渡操作符。我们也需要一个末端操作符来收集流。
否则仅调用 <code>onEach</code> 是无效的。</p>
<p>如果我们在 <code>onEach</code> 之后使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/collect.html" target="_blank">collect</a> 末端操作符，那么后面的代码会一直等待直至流被收集：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-comment">// 模仿事件流</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">events</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">100</span>) }

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    events()
        .onEach { event -&gt; println(<span class="hljs-string">"Event: <span class="hljs-variable">$event</span>"</span>) }
        .collect() <span class="hljs-comment">// &lt;--- 等待流收集</span>
    println(<span class="hljs-string">"Done"</span>)
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-35.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg> 

</blockquote>
<p>你可以看到它的输出：</p>
<pre><code class="lang-text">Event: 1
Event: 2
Event: 3
Done
</code></pre>
<!--- TEST -->
<p><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/launch-in.html" target="_blank">launchIn</a> 末端操作符可以在这里派上用场。使用 <code>launchIn</code> 替换 <code>collect</code> 我们可以<!--
-->在单独的协程中启动流的收集，这样就可以立即继续<!--
-->进一步执行代码：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">// 模仿事件流</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">events</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = (<span class="hljs-number">1.</span><span class="hljs-number">.3</span>).asFlow().onEach { delay(<span class="hljs-number">100</span>) }

<span class="hljs-comment">//sampleStart</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    events()
        .onEach { event -&gt; println(<span class="hljs-string">"Event: <span class="hljs-variable">$event</span>"</span>) }
        .launchIn(<span class="hljs-keyword">this</span>) <span class="hljs-comment">// &lt;--- 在单独的协程中执行流</span>
    println(<span class="hljs-string">"Done"</span>)
}            
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-36.kt">这里</a>获取完整代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg> 

</blockquote>
<p>它打印了：</p>
<pre><code class="lang-text">Done
Event: 1
Event: 2
Event: 3
</code></pre>
<!--- TEST -->
<p><code>launchIn</code> 必要的参数 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-scope/index.html" target="_blank">CoroutineScope</a> 指定了用哪一个协程来启动流的<!--
-->收集。在先前的示例中这个作用域来自 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/run-blocking.html" target="_blank">runBlocking</a>
协程构建器，在这个流运行的时候，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/run-blocking.html" target="_blank">runBlocking</a> 作用域等待它的子协程执行完毕<!--
-->并防止 main 函数返回并终止此示例。</p>
<p>在实际的应用中，作用域来自于一个寿命有限的<!--
-->实体。在该实体的寿命终止后，相应的作用域就会被取消，即取消<!--
-->相应流的收集。这种成对的 <code>onEach { ... }.launchIn(scope)</code> 工作方式<!--
-->就像 <code>addEventListener</code> 一样。而且，这不需要相应的 <code>removeEventListener</code> 函数，
因为取消与结构化并发可以达成这个目的。</p>
<p>注意，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/launch-in.html" target="_blank">launchIn</a> 也会返回一个 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-job/index.html" target="_blank">Job</a>，可以在不取消整个作用域的情况下仅<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/cancel.html" target="_blank">取消</a>相应的流收集<!--
-->或对其进行 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-job/join.html" target="_blank">join</a>。</p>
<h3 id="流取消检测">流取消检测</h3>
<p>为方便起见，<a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/flow.html" target="_blank">流</a>构建器对每个发射值执行附加的 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/ensure-active.html" target="_blank">ensureActive</a> 检测以进行取消。
这意味着从 <code>flow { ... }</code> 发出的繁忙循环是可以取消的：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart           </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow { 
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) {
        println(<span class="hljs-string">"Emitting <span class="hljs-variable">$i</span>"</span>) 
        emit(i) 
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    foo().collect { value -&gt; 
        <span class="hljs-keyword">if</span> (value == <span class="hljs-number">3</span>) cancel()  
        println(value)
    } 
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-37.kt">这里</a>获取完整的代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>仅得到不超过 3 的数字，在尝试发出 4 之后抛出 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-cancellation-exception/index.html" target="_blank">CancellationException</a>；</p>
<pre><code class="lang-text">Emitting 1
1
Emitting 2
2
Emitting 3
3
Emitting 4
Exception in thread "main" kotlinx.coroutines.JobCancellationException: BlockingCoroutine was cancelled; job="coroutine#1":BlockingCoroutine{Cancelled}@6d7b4f4c
</code></pre>
<!--- TEST EXCEPTION -->
<p>但是，出于性能原因，大多数其他流操作不会自行执行其他取消检测。
例如，如果使用 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/as-flow.html" target="_blank">IntRange.asFlow</a> 扩展来编写相同的繁忙循环，
并且没有在任何地方暂停，那么就没有取消的检测；</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart           </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    (<span class="hljs-number">1.</span><span class="hljs-number">.5</span>).asFlow().collect { value -&gt; 
        <span class="hljs-keyword">if</span> (value == <span class="hljs-number">3</span>) cancel()  
        println(value)
    } 
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-38.kt">这里</a>获取完整的代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>收集从 1 到 5 的所有数字，并且仅在从 <code>runBlocking</code> 返回之前检测到取消：</p>
<pre><code class="lang-text">1
2
3
4
5
Exception in thread "main" kotlinx.coroutines.JobCancellationException: BlockingCoroutine was cancelled; job="coroutine#1":BlockingCoroutine{Cancelled}@3327bd23
</code></pre>
<!--- TEST EXCEPTION -->
<h4 id="让繁忙的流可取消">让繁忙的流可取消</h4>
<p>在协程处于繁忙循环的情况下，必须明确检测是否取消。
可以添加 <code>.onEach { currentCoroutineContext().ensureActive() }</code>，
但是这里提供了一个现成的 <a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/cancellable.html" target="_blank">cancellable</a> 操作符来执行此操作：</p>
<pre><code class="lang-kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">//sampleStart           </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking&lt;<span class="hljs-built_in">Unit</span>&gt; {
    (<span class="hljs-number">1.</span><span class="hljs-number">.5</span>).asFlow().cancellable().collect { value -&gt; 
        <span class="hljs-keyword">if</span> (value == <span class="hljs-number">3</span>) cancel()  
        println(value)
    } 
}
<span class="hljs-comment">//sampleEnd</span>
</code></pre>
<blockquote>
<p>可以在<a href="../../kotlinx-coroutines-core/jvm/test/guide/example-flow-39.kt">这里</a>获取完整的代码。</p>
<svg width="24" height="24" fill="#4dbb5f" viewbox="0 0 24 24"><path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path></svg>

</blockquote>
<p>使用 <code>cancellable</code> 操作符，仅收集从 1 到 3 的数字：</p>
<pre><code class="lang-text">1
2
3
Exception in thread "main" kotlinx.coroutines.JobCancellationException: BlockingCoroutine was cancelled; job="coroutine#1":BlockingCoroutine{Cancelled}@5ec0a365
</code></pre>
<!--- TEST EXCEPTION -->
<h2 id="流（flow）与响应式流（reactive-streams）">流（Flow）与响应式流（Reactive Streams）</h2>
<p>对于熟悉响应式流（<a href="https://www.reactive-streams.org/" target="_blank">Reactive Streams</a>）或诸如 RxJava 与 Project Reactor 这样的响应式框架的人来说，
Flow 的设计也许看起来会非常熟悉。</p>
<p>确实，其设计灵感来源于响应式流以及其各种实现。但是 Flow 的主要目标是拥有尽可能简单的设计，
对 Kotlin 以及挂起友好且遵从结构化并发。没有响应式的先驱及他们大量的工作，就不可能实现这一目标。你可以阅读 <a href="https://medium.com/@elizarov/reactive-streams-and-kotlin-flows-bfd12772cda4" target="_blank">Reactive Streams and Kotlin Flows</a> 这篇文章来了解完成 Flow 的故事。</p>
<p>虽然有所不同，但从概念上讲，Flow <em>依然是</em>响应式流，并且可以将它转换为响应式（规范及符合 TCK）的发布者（Publisher），反之亦然。
这些开箱即用的转换器可以在 <code>kotlinx.coroutines</code> 提供的相关响应式模块（<code>kotlinx-coroutines-reactive</code> 用于 Reactive Streams，<code>kotlinx-coroutines-reactor</code> 用于 Project Reactor，以及 <code>kotlinx-coroutines-rx2</code>/<code>kotlinx-coroutines-rx3</code> 用于 RxJava2/RxJava3）中找到。
集成模块包含 <code>Flow</code> 与其他实现之间的转换，与 Reactor 的 <code>Context</code> 集成以及与一系列响应式实体配合使用的挂起友好的使用方式。</p>
<!-- stdlib references -->
<!--- MODULE kotlinx-coroutines-core -->
<!--- INDEX kotlinx.coroutines -->
<!--- INDEX kotlinx.coroutines.flow -->
<!--- END -->

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="coroutine-context-and-dispatchers.html" class="navigation navigation-prev " aria-label="Previous page: 协程上下文与调度器">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="channels.html" class="navigation navigation-next " aria-label="Next page: 通道">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"异步流","level":"1.13.1.7","depth":3,"next":{"title":"通道","level":"1.13.1.8","depth":3,"path":"text/channels.md","ref":"text/channels.md","articles":[]},"previous":{"title":"协程上下文与调度器","level":"1.13.1.6","depth":3,"path":"text/coroutine-context-and-dispatchers.md","ref":"text/coroutine-context-and-dispatchers.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Kotlin 官方文档 中文版","language":"zh-hans","gitbook":"*"},"file":{"path":"text/flow.md","mtime":"2025-06-14T13:15:38.000Z","type":"markdown"},"gitbook":{"version":"6.0.3","time":"2025-06-14T13:17:47.927Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/@honkit/honkit-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

